<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>PDF Master Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg: #0f1014;
      --bg-alt: #181a20;
      --accent: #2dd4ff;
      --accent-soft: rgba(45, 212, 255, 0.15);
      --danger: #ff4d4f;
      --success: #22c55e;
      --text: #f9fafb;
      --muted: #9ca3af;
      --border: #272a33;
      --radius-lg: 16px;
      --radius-md: 10px;
      --radius-sm: 6px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .app {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .app-header {
      position: sticky;
      top: 0;
      z-index: 20;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 18px;
      background: linear-gradient(to right, #020617dd, #020617f5);
      border-bottom: 1px solid var(--border);
      backdrop-filter: blur(12px);
    }

    .app-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 20%, #ffffff 0, #60a5fa 30%, #0ea5e9 55%, #020617 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 16px;
      color: #020617;
      box-shadow: 0 0 20px rgba(56,189,248,0.5);
    }

    .title-text-main {
      font-weight: 700;
      font-size: 18px;
    }

    .title-text-sub {
      font-size: 12px;
      color: var(--muted);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .lang-toggle {
      display: flex;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #020617;
      overflow: hidden;
    }

    .lang-btn {
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
      border: none;
      background: transparent;
      color: var(--muted);
      min-width: 40px;
      text-align: center;
    }

    .lang-btn.active {
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 600;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid var(--border);
      font-size: 11px;
      color: var(--muted);
    }

    .status-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: var(--danger);
    }

    .status-dot.online {
      background: var(--success);
      box-shadow: 0 0 8px rgba(34,197,94,0.8);
    }

    .layout {
      flex: 1;
      display: flex;
      min-height: 0;
    }

    .sidebar {
      width: 250px;
      background: linear-gradient(to bottom, #020617, #020617ee);
      border-inline-end: 1px solid var(--border);
      padding: 14px 10px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .sidebar-section-title {
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
      margin: 4px 6px;
    }

    .nav-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .nav-item {
      border-radius: var(--radius-md);
      padding: 8px 10px;
      cursor: pointer;
      font-size: 13px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.15s, color 0.15s, transform 0.1s;
    }

    .nav-item span {
      display: flex;
      align-items: center;
      gap: 7px;
    }

    .nav-item:hover {
      background: #020617;
      color: var(--text);
      transform: translateY(-1px);
    }

    .nav-item.active {
      background: var(--accent-soft);
      color: var(--accent);
      border: 1px solid rgba(45,212,255,0.5);
    }

    .nav-pill {
      font-size: 10px;
      padding: 1px 6px;
      border-radius: 999px;
      background: #111827;
      color: var(--muted);
    }

    .main {
      flex: 1;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow: auto;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
    }

    .section-subtitle {
      font-size: 12px;
      color: var(--muted);
    }

    .section-badge {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #020617;
      color: var(--muted);
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.2fr);
      gap: 12px;
    }

    .card {
      background: linear-gradient(to bottom right, #020617f2, #020617ea);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: 14px 14px 16px;
      box-shadow: 0 14px 40px rgba(15,23,42,0.9);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at top left, rgba(56,189,248,0.05) 0, transparent 50%);
      pointer-events: none;
    }

    .card-header {
      position: relative;
      z-index: 1;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
    }

    .card-subtitle {
      font-size: 11px;
      color: var(--muted);
    }

    .card-badge {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #020617;
      color: var(--muted);
    }

    .card-body {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
    }

    .input-label {
      color: var(--muted);
      font-size: 11px;
    }

    .input {
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: #020617;
      padding: 6px 8px;
      color: var(--text);
      font-size: 13px;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
    }

    .input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(45,212,255,0.5);
    }

    .input::placeholder {
      color: #4b5563;
    }

    textarea.input {
      resize: vertical;
      min-height: 70px;
      max-height: 200px;
    }

    .btn {
      border-radius: var(--radius-md);
      border: 1px solid transparent;
      padding: 7px 10px;
      font-size: 13px;
      cursor: pointer;
      background: var(--accent);
      color: #020617;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: background 0.15s, transform 0.1s, box-shadow 0.15s;
    }

    .btn:hover {
      background: #22c1f6;
      transform: translateY(-1px);
      box-shadow: 0 12px 30px rgba(37, 99, 235, 0.5);
    }

    .btn:disabled {
      opacity: 0.45;
      cursor: default;
      transform: none;
      box-shadow: none;
    }

    .btn-secondary {
      background: #020617;
      color: var(--muted);
      border-color: var(--border);
    }

    .btn-secondary:hover {
      background: #020617;
      color: var(--text);
      box-shadow: 0 12px 30px rgba(15,23,42,0.9);
    }

    .btn-danger {
      background: var(--danger);
      color: #fff;
    }

    .btn-danger:hover {
      background: #f97373;
      box-shadow: 0 12px 30px rgba(248,113,113,0.6);
    }

    .btn-sm {
      padding: 4px 7px;
      font-size: 11px;
    }

    .btn-icon {
      width: 26px;
      height: 26px;
      padding: 0;
      border-radius: 999px;
    }

    .file-drop {
      border-radius: var(--radius-lg);
      border: 1px dashed rgba(45,212,255,0.5);
      background: radial-gradient(circle at top left, rgba(45,212,255,0.06), #020617dd);
      padding: 18px 10px;
      text-align: center;
      cursor: pointer;
      transition: border 0.15s, background 0.15s, transform 0.1s;
      font-size: 13px;
      color: var(--muted);
    }

    .file-drop:hover,
    .file-drop.dragover {
      border-color: var(--accent);
      background: radial-gradient(circle at top left, rgba(45,212,255,0.12), #020617f0);
      transform: translateY(-1px);
    }

    .file-drop-title {
      font-size: 13px;
      color: var(--text);
      margin-bottom: 4px;
    }

    .file-drop-sub {
      font-size: 11px;
      color: var(--muted);
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #020617;
      padding: 2px 8px;
      font-size: 11px;
      color: var(--muted);
    }

    .file-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 220px;
      overflow: auto;
    }

    .file-item {
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: #020617;
      padding: 6px 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
    }

    .file-item-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .file-name {
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .file-status {
      font-size: 11px;
      color: var(--muted);
    }

    .file-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
      color: var(--muted);
    }

    .file-progress {
      height: 5px;
      border-radius: 999px;
      overflow: hidden;
      background: #111827;
    }

    .file-progress-bar {
      height: 100%;
      width: 0;
      background: linear-gradient(to right, #22c55e, #2dd4ff);
      transition: width 0.2s linear;
    }

    .two-col {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 8px;
    }

    .text-output {
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: #020617;
      padding: 8px;
      font-size: 12px;
      color: var(--muted);
      max-height: 260px;
      overflow: auto;
      white-space: pre-wrap;
    }

    .log-console {
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: #020617;
      padding: 8px;
      font-size: 11px;
      color: var(--muted);
      max-height: 220px;
      overflow: auto;
    }

    .log-line {
      margin-bottom: 3px;
      opacity: 0.8;
    }

    .log-line span {
      color: #64748b;
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 5px;
      font-size: 11px;
      max-height: 220px;
      overflow: auto;
    }

    .history-item {
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: #020617;
      padding: 5px 7px;
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }

    .history-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .history-type {
      font-weight: 500;
    }

    .history-meta {
      color: var(--muted);
    }

    .history-status {
      font-size: 11px;
    }

    .history-status.success {
      color: var(--success);
    }
    .history-status.error {
      color: var(--danger);
    }

    .badge {
      border-radius: 999px;
      padding: 1px 6px;
      font-size: 10px;
      background: #020617;
      border: 1px solid var(--border);
      color: var(--muted);
    }

    .select {
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: #020617;
      padding: 6px 8px;
      color: var(--text);
      font-size: 13px;
      outline: none;
    }

    .stack {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    @media (max-width: 900px) {
      .layout {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        border-inline-end: none;
        border-bottom: 1px solid var(--border);
        padding-bottom: 8px;
        overflow-x: auto;
      }

      .nav-list {
        flex-direction: row;
        overflow-x: auto;
      }

      .nav-item {
        flex: 0 0 auto;
        min-width: 140px;
      }

      .grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 640px) {
      .app-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .header-right {
        width: 100%;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body>
<div class="app">
  <header class="app-header">
    <div class="app-title">
      <div class="logo">P</div>
      <div>
        <div class="title-text-main" data-i18n="appTitle">PDF Master Tool</div>
        <div class="title-text-sub" data-i18n="appSubtitle">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„ÙƒÙ„ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù€ PDF</div>
      </div>
    </div>
    <div class="header-right">
      <div class="lang-toggle">
        <button class="lang-btn active" data-lang="ar">AR</button>
        <button class="lang-btn" data-lang="en">EN</button>
      </div>
      <div class="status-pill">
        <span class="status-dot" id="statusDot"></span>
        <span id="statusText">Checking...</span>
      </div>
    </div>
  </header>

  <div class="layout">
    <aside class="sidebar">
      <div class="sidebar-section-title" data-i18n="navMain">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div>
      <div class="nav-list">
        <div class="nav-item active" data-section="compress">
          <span>
            <span>ğŸ“¦</span>
            <span data-i18n="navCompress">Ø¶ØºØ· Ø§Ù„Ù…Ù„ÙØ§Øª</span>
          </span>
          <span class="nav-pill">Pro</span>
        </div>
        <div class="nav-item" data-section="merge">
          <span>
            <span>â•</span>
            <span data-i18n="navMerge">Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª</span>
          </span>
        </div>
        <div class="nav-item" data-section="split">
          <span>
            <span>âœ‚ï¸</span>
            <span data-i18n="navSplit">ØªÙ‚Ø³ÙŠÙ… / Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØµÙØ­Ø§Øª</span>
          </span>
        </div>
        <div class="nav-item" data-section="text">
          <span>
            <span>ğŸ“</span>
            <span data-i18n="navText">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ</span>
          </span>
        </div>
        <div class="nav-item" data-section="info">
          <span>
            <span>â„¹ï¸</span>
            <span data-i18n="navInfo">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù</span>
          </span>
        </div>
      </div>

      <div class="sidebar-section-title" data-i18n="navAdvanced">Ù…ØªÙ‚Ø¯Ù‘Ù…</div>
      <div class="nav-list">
        <div class="nav-item" data-section="protect">
          <span>
            <span>ğŸ”</span>
            <span data-i18n="navProtect">Ø­Ù…Ø§ÙŠØ© / ÙÙƒ Ø§Ù„Ø­Ù…Ø§ÙŠØ©</span>
          </span>
        </div>
        <div class="nav-item" data-section="watermark">
          <span>
            <span>ğŸ’§</span>
            <span data-i18n="navWatermark">Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©</span>
          </span>
        </div>
        <div class="nav-item" data-section="rotate">
          <span>
            <span>ğŸ”„</span>
            <span data-i18n="navRotate">ØªØ¯ÙˆÙŠØ± / Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨</span>
          </span>
        </div>
      </div>

      <div class="sidebar-section-title" data-i18n="navSystem">Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„Ù†Ø¸Ø§Ù…</div>
      <div class="nav-list">
        <div class="nav-item" data-section="supabase">
          <span>
            <span>ğŸ—‚ï¸</span>
            <span data-i18n="navSupabase">Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Supabase</span>
          </span>
        </div>
        <div class="nav-item" data-section="history">
          <span>
            <span>ğŸ“Š</span>
            <span data-i18n="navHistory">Ø§Ù„Ø³Ø¬Ù„ Ùˆ Ø§Ù„Ø­Ø§Ù„Ø©</span>
          </span>
        </div>
      </div>
    </aside>

    <main class="main">
      <section id="section-compress" class="section">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="compressTitle">Ø¶ØºØ· Ù…Ù„ÙØ§Øª PDF</div>
            <div class="section-subtitle" data-i18n="compressSubtitle">Ø±ÙØ¹ØŒ Ø¶ØºØ·ØŒ ÙˆØªÙ†Ø²ÙŠÙ„ Ù…Ù„ÙØ§Øª PDF Ø¨Ø£Ø¹Ù„Ù‰ ÙƒÙØ§Ø¡Ø©</div>
          </div>
          <div class="section-badge" data-i18n="sectionPowered">Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø³ÙŠØ±ÙØ± PDF PRO</div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="compressUploadTitle">Ø±ÙØ¹ ÙˆØ¶ØºØ· Ø¹Ø¯Ø© Ù…Ù„ÙØ§Øª</div>
                <div class="card-subtitle" data-i18n="compressUploadSubtitle">Ø±ÙØ¹ Ø¥Ù„Ù‰ Supabase Ø«Ù… Ø¶ØºØ· Ø¹Ø¨Ø± Ø§Ù„Ø³ÙŠØ±ÙØ±</div>
              </div>
            </div>
            <div class="card-body">
              <div id="compress-drop" class="file-drop">
                <div class="file-drop-title" data-i18n="compressDropTitle">Ø§Ø³Ø­Ø¨ Ù…Ù„ÙØ§Øª PDF Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</div>
                <div class="file-drop-sub" data-i18n="compressDropSub">ÙŠØ¯Ø¹Ù… Ø±ÙØ¹ Ø¹Ø¯Ø© Ù…Ù„ÙØ§Øª ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª</div>
              </div>
              <input type="file" id="compress-input" accept="application/pdf" multiple style="display:none">

              <div class="file-list" id="compress-file-list"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="compressUrlTitle">Ø¶ØºØ· Ù…Ù† Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø©</div>
                <div class="card-subtitle" data-i18n="compressUrlSubtitle">Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· PDF Ù…Ø¨Ø§Ø´Ø± ÙˆØ³ÙŠØªÙ… Ø¶ØºØ·Ù‡ ÙˆØªÙ†Ø²ÙŠÙ„Ù‡</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="input-group">
                <label class="input-label" data-i18n="compressUrlLabel">Ø±Ø§Ø¨Ø· Ù…Ù„Ù PDF</label>
                <input class="input" id="compress-url-input" placeholder="https://example.com/file.pdf">
              </div>
              <button class="btn" id="compress-url-btn">
                <span data-i18n="btnCompressUrl">Ø¶ØºØ· Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·</span>
              </button>
              <div class="chips">
                <div class="chip" data-i18n="hintSecure">Ù„Ø§ ÙŠØªÙ… ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ù„ÙØ§Øª Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="section-merge" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="mergeTitle">Ø¯Ù…Ø¬ Ù…Ù„ÙØ§Øª PDF</div>
            <div class="section-subtitle" data-i18n="mergeSubtitle">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ Ø£Ùˆ Ù…Ù† Supabase Ø«Ù… Ø¯Ù…Ø¬Ù‡Ø§ Ø¨ØªØ±ØªÙŠØ¨ Ù…Ø®ØµØµ</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="mergeLocalTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ù„ÙØ§Øª Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</div>
                <div class="card-subtitle" data-i18n="mergeLocalSubtitle">Ø§Ù„Ù…Ù„ÙØ§Øª Ø³ÙŠØªÙ… Ø±ÙØ¹Ù‡Ø§ Ø¥Ù„Ù‰ Supabase ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</div>
              </div>
            </div>
            <div class="card-body stack">
              <div id="merge-drop" class="file-drop">
                <div class="file-drop-title" data-i18n="mergeDropTitle">Ø§Ø³Ø­Ø¨ Ù…Ù„ÙØ§Øª PDF Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø¥Ø¶Ø§ÙØ©</div>
                <div class="file-drop-sub" data-i18n="mergeDropSub">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨Ù‡Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ù…Ø¬</div>
              </div>
              <input type="file" id="merge-input" accept="application/pdf" multiple style="display:none">
              <div class="file-list" id="merge-file-list"></div>
              <button class="btn" id="merge-btn">
                <span data-i18n="btnMerge">Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</span>
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="mergeSupabaseTitle">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Supabase</div>
                <div class="card-subtitle" data-i18n="mergeSupabaseSubtitle">Ø§Ø®ØªØ± Ù…Ù„ÙØ§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§ ÙÙŠ Ø§Ù„Ø¨Ø§ÙƒØª</div>
              </div>
              <button class="btn-secondary btn-sm" id="merge-refresh-supa">
                <span data-i18n="btnRefresh">ØªØ­Ø¯ÙŠØ«</span>
              </button>
            </div>
            <div class="card-body stack">
              <div class="file-list" id="merge-supabase-list"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="section-split" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="splitTitle">ØªÙ‚Ø³ÙŠÙ… / Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØµÙØ­Ø§Øª</div>
            <div class="section-subtitle" data-i18n="splitSubtitle">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="splitSourceTitle">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±</div>
                <div class="card-subtitle" data-i18n="splitSourceSubtitle">Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² (Ù…Ø±ÙÙˆØ¹ Ø¥Ù„Ù‰ Supabase) Ø£Ùˆ Ù…Ù† Supabase Ù…Ø¨Ø§Ø´Ø±Ø©</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="row">
                <button class="btn-secondary btn-sm" id="split-local-btn" data-i18n="btnChooseLocal">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
                <button class="btn-secondary btn-sm" id="split-supa-refresh" data-i18n="btnChooseSupabase">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase</button>
              </div>
              <input type="file" id="split-input" accept="application/pdf" style="display:none">
              <div class="file-list" id="split-supa-list"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="splitPagesTitle">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙØ­Ø§Øª</div>
                <div class="card-subtitle" data-i18n="splitPagesSubtitle">Ù…Ø«Ø§Ù„: 1-3,5,7-8</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="input-group">
                <label class="input-label" data-i18n="splitPagesLabel">Ù†Ø·Ø§Ù‚ Ø§Ù„ØµÙØ­Ø§Øª</label>
                <input class="input" id="split-pages-input" placeholder="1-3,5,7-8">
              </div>
              <button class="btn" id="split-extract-btn">
                <span data-i18n="btnExtractPages">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</span>
              </button>
            </div>
          </div>
        </div>
      </section>

      <section id="section-text" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="textTitle">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ</div>
            <div class="section-subtitle" data-i18n="textSubtitle">Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Øµ Ù…Ù† Ù…Ù„ÙØ§Øª PDF ÙˆØ¹Ø±Ø¶Ù‡ Ø£Ùˆ ØªØ­Ù…ÙŠÙ„Ù‡ ÙƒÙ…Ù„Ù Ù†ØµÙŠ</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="textSourceTitle">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="row">
                <button class="btn-secondary btn-sm" id="text-local-btn" data-i18n="btnChooseLocal">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
                <button class="btn-secondary btn-sm" id="text-supa-refresh" data-i18n="btnChooseSupabase">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase</button>
              </div>
              <input type="file" id="text-input" accept="application/pdf" style="display:none">
              <div class="file-list" id="text-supa-list"></div>
              <button class="btn" id="text-extract-btn">
                <span data-i18n="btnExtractText">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ</span>
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="textOutputTitle">Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬</div>
              </div>
              <div class="row">
                <button class="btn-secondary btn-sm" id="text-copy-btn" data-i18n="btnCopyText">Ù†Ø³Ø® Ø§Ù„Ù†Øµ</button>
                <button class="btn-secondary btn-sm" id="text-download-btn" data-i18n="btnDownloadText">ØªØ­Ù…ÙŠÙ„ ÙƒÙ…Ù„Ù TXT</button>
              </div>
            </div>
            <div class="card-body">
              <div class="text-output" id="text-output"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="section-info" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="infoTitle">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ù…Ù„Ù PDF</div>
            <div class="section-subtitle" data-i18n="infoSubtitle">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§ØªØŒ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„ÙØŒ ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="infoSourceTitle">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="row">
                <button class="btn-secondary btn-sm" id="info-local-btn" data-i18n="btnChooseLocal">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
                <button class="btn-secondary btn-sm" id="info-supa-refresh" data-i18n="btnChooseSupabase">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase</button>
              </div>
              <input type="file" id="info-input" accept="application/pdf" style="display:none">
              <div class="file-list" id="info-supa-list"></div>
              <button class="btn" id="info-fetch-btn">
                <span data-i18n="btnGetInfo">Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</span>
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="infoDetailsTitle">Ø§Ù„Ù†ØªÙŠØ¬Ø©</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="chips" id="info-result-chips"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="section-protect" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="protectTitle">Ø­Ù…Ø§ÙŠØ© / ÙÙƒ Ø§Ù„Ø­Ù…Ø§ÙŠØ©</div>
            <div class="section-subtitle" data-i18n="protectSubtitle">Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø© Ø­Ù…Ø§ÙŠØ© Ù…Ù†Ø·Ù‚ÙŠØ© Ø£Ùˆ Ø¥Ø²Ø§Ù„Ø© ØµÙØ­Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="protectAddTitle">Ø¥Ø¶Ø§ÙØ© Ø­Ù…Ø§ÙŠØ© (Ù…Ù†Ø·Ù‚ÙŠØ©)</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="row">
                <button class="btn-secondary btn-sm" id="protect-local-btn" data-i18n="btnChooseLocal">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
                <button class="btn-secondary btn-sm" id="protect-supa-refresh" data-i18n="btnChooseSupabase">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase</button>
              </div>
              <input type="file" id="protect-input" accept="application/pdf" style="display:none">
              <div class="file-list" id="protect-supa-list"></div>

              <div class="input-group">
                <label class="input-label" data-i18n="protectPasswordLabel">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input class="input" id="protect-password-input" type="text" placeholder="********">
              </div>
              <button class="btn" id="protect-btn">
                <span data-i18n="btnProtect">Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ù…Ø­Ù…ÙŠØ©</span>
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="unlockTitle">ÙÙƒ Ø§Ù„Ø­Ù…Ø§ÙŠØ©</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="row">
                <button class="btn-secondary btn-sm" id="unlock-local-btn" data-i18n="btnChooseLocal">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
                <button class="btn-secondary btn-sm" id="unlock-supa-refresh" data-i18n="btnChooseSupabase">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase</button>
              </div>
              <input type="file" id="unlock-input" accept="application/pdf" style="display:none">
              <div class="file-list" id="unlock-supa-list"></div>
              <button class="btn" id="unlock-btn">
                <span data-i18n="btnUnlock">Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø¨Ø¯ÙˆÙ† Ø­Ù…Ø§ÙŠØ©</span>
              </button>
            </div>
          </div>
        </div>
      </section>

      <section id="section-watermark" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="watermarkTitle">Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© (Ù†Øµ)</div>
            <div class="section-subtitle" data-i18n="watermarkSubtitle">Ø¥Ø¶Ø§ÙØ© Ù†Øµ Ù…Ø§Ø¦Ù„ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="watermarkSourceTitle">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="row">
                <button class="btn-secondary btn-sm" id="wm-local-btn" data-i18n="btnChooseLocal">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
                <button class="btn-secondary btn-sm" id="wm-supa-refresh" data-i18n="btnChooseSupabase">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase</button>
              </div>
              <input type="file" id="wm-input" accept="application/pdf" style="display:none">
              <div class="file-list" id="wm-supa-list"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="watermarkOptionsTitle">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="input-group">
                <label class="input-label" data-i18n="watermarkTextLabel">Ø§Ù„Ù†Øµ</label>
                <input class="input" id="wm-text-input" placeholder="CONFIDENTIAL / Ø³Ø±ÙŠ">
              </div>
              <div class="two-col">
                <div class="input-group">
                  <label class="input-label" data-i18n="watermarkColorLabel">Ø§Ù„Ù„ÙˆÙ†</label>
                  <select class="select" id="wm-color-select">
                    <option value="red">Red</option>
                    <option value="blue">Blue</option>
                    <option value="green">Green</option>
                    <option value="white">White</option>
                    <option value="black">Black</option>
                  </select>
                </div>
                <div class="input-group">
                  <label class="input-label" data-i18n="watermarkOpacityLabel">Ø§Ù„Ø´ÙØ§ÙÙŠØ©</label>
                  <input class="input" id="wm-opacity-input" type="number" min="0.1" max="1" step="0.1" value="0.2">
                </div>
              </div>
              <button class="btn" id="wm-apply-btn">
                <span data-i18n="btnApplyWatermark">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©</span>
              </button>
            </div>
          </div>
        </div>
      </section>

      <section id="section-rotate" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="rotateTitle">ØªØ¯ÙˆÙŠØ± / Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙØ­Ø§Øª</div>
            <div class="section-subtitle" data-i18n="rotateSubtitle">ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ ÙÙŠ ØªØ±ØªÙŠØ¨ ÙˆØ§ØªØ¬Ø§Ù‡ Ø§Ù„ØµÙØ­Ø§Øª</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="rotateSourceTitle">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="row">
                <button class="btn-secondary btn-sm" id="rot-local-btn" data-i18n="btnChooseLocal">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
                <button class="btn-secondary btn-sm" id="rot-supa-refresh" data-i18n="btnChooseSupabase">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase</button>
              </div>
              <input type="file" id="rot-input" accept="application/pdf" style="display:none">
              <div class="file-list" id="rot-supa-list"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="rotateOptsTitle">Ø§Ù„ØªØ¯ÙˆÙŠØ± ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="two-col">
                <div class="input-group">
                  <label class="input-label" data-i18n="rotateAngleLabel">Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØªØ¯ÙˆÙŠØ±</label>
                  <select class="select" id="rot-angle-select">
                    <option value="90">90Â°</option>
                    <option value="180">180Â°</option>
                    <option value="270">270Â°</option>
                  </select>
                </div>
                <div class="input-group">
                  <label class="input-label" data-i18n="rotatePagesLabel">Ø§Ù„ØµÙØ­Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                  <input class="input" id="rot-pages-input" placeholder="all Ø£Ùˆ 1-3,5">
                </div>
              </div>
              <button class="btn" id="rot-apply-btn">
                <span data-i18n="btnApplyRotate">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¯ÙˆÙŠØ±</span>
              </button>

              <div class="input-group">
                <label class="input-label" data-i18n="reorderLabel">ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙØ­Ø§Øª (Ù…Ø«Ø§Ù„: 3,1,2)</label>
                <input class="input" id="reorder-input" placeholder="3,1,2">
              </div>
              <button class="btn-secondary" id="reorder-apply-btn">
                <span data-i18n="btnApplyReorder">ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨</span>
              </button>
            </div>
          </div>
        </div>
      </section>

      <section id="section-supabase" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="supaTitle">Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Supabase</div>
            <div class="section-subtitle" data-i18n="supaSubtitle">Ø§Ø³ØªØ¹Ø±Ø§Ø¶ØŒ Ø¶ØºØ·ØŒ Ø­Ø°ÙØŒ ÙˆÙ†Ø³Ø® Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="supaUploadTitle">Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Supabase</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="file-drop" id="supa-upload-drop">
                <div class="file-drop-title" data-i18n="supaDropTitle">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</div>
                <div class="file-drop-sub" data-i18n="supaDropSub">ÙŠØªÙ… Ø±ÙØ¹Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø§ÙƒØª pdf-files</div>
              </div>
              <input type="file" id="supa-upload-input" accept="application/pdf" multiple style="display:none">
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="supaListTitle">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª</div>
              </div>
              <button class="btn-secondary btn-sm" id="supa-refresh-btn" data-i18n="btnRefresh">ØªØ­Ø¯ÙŠØ«</button>
            </div>
            <div class="card-body">
              <div class="file-list" id="supa-file-list"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="section-history" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="historyTitle">Ø§Ù„Ø³Ø¬Ù„ Ùˆ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±</div>
            <div class="section-subtitle" data-i18n="historySubtitle">Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ù…Ù„ÙŠØ§ØªÙƒ ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ±ÙØ± ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="historyOpsTitle">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
              </div>
              <button class="btn-secondary btn-sm" id="history-clear-btn" data-i18n="btnClearHistory">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
            </div>
            <div class="card-body">
              <div class="history-list" id="history-list"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="logsTitle">Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</div>
              </div>
              <button class="btn-secondary btn-sm" id="logs-clear-btn" data-i18n="btnClearLogs">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
            </div>
            <div class="card-body">
              <div class="log-console" id="logs-console"></div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>

<script type="module">
  const SERVER_BASE = "https://pdf-server-navy.vercel.app";
  const SUPABASE_URL = "https://tdqewqarcvdunwuxgios.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRkcWV3cWFyY3ZkdW53dXhnaW9zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0ODc4NDcsImV4cCI6MjA4MTA2Mzg0N30.RSMghTLwda7kLidTohBFLqE7qCQoHs3S6l88ewUidRw";
  const BUCKET_NAME = "pdf-files";

  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
  const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

  const i18n = {
    ar: {
      appTitle: "PDF Master Tool",
      appSubtitle: "Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„ÙƒÙ„ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù€ PDF",
      navMain: "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©",
      navCompress: "Ø¶ØºØ· Ø§Ù„Ù…Ù„ÙØ§Øª",
      navMerge: "Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª",
      navSplit: "ØªÙ‚Ø³ÙŠÙ… / Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØµÙØ­Ø§Øª",
      navText: "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ",
      navInfo: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù",
      navAdvanced: "Ù…ØªÙ‚Ø¯Ù‘Ù…",
      navProtect: "Ø­Ù…Ø§ÙŠØ© / ÙÙƒ Ø§Ù„Ø­Ù…Ø§ÙŠØ©",
      navWatermark: "Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©",
      navRotate: "ØªØ¯ÙˆÙŠØ± / Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨",
      navSystem: "Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„Ù†Ø¸Ø§Ù…",
      navSupabase: "Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Supabase",
      navHistory: "Ø§Ù„Ø³Ø¬Ù„ Ùˆ Ø§Ù„Ø­Ø§Ù„Ø©",
      compressTitle: "Ø¶ØºØ· Ù…Ù„ÙØ§Øª PDF",
      compressSubtitle: "Ø±ÙØ¹ØŒ Ø¶ØºØ·ØŒ ÙˆØªÙ†Ø²ÙŠÙ„ Ù…Ù„ÙØ§Øª PDF Ø¨Ø£Ø¹Ù„Ù‰ ÙƒÙØ§Ø¡Ø©",
      sectionPowered: "Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø³ÙŠØ±ÙØ± PDF PRO",
      compressUploadTitle: "Ø±ÙØ¹ ÙˆØ¶ØºØ· Ø¹Ø¯Ø© Ù…Ù„ÙØ§Øª",
      compressUploadSubtitle: "Ø±ÙØ¹ Ø¥Ù„Ù‰ Supabase Ø«Ù… Ø¶ØºØ· Ø¹Ø¨Ø± Ø§Ù„Ø³ÙŠØ±ÙØ±",
      compressDropTitle: "Ø§Ø³Ø­Ø¨ Ù…Ù„ÙØ§Øª PDF Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±",
      compressDropSub: "ÙŠØ¯Ø¹Ù… Ø±ÙØ¹ Ø¹Ø¯Ø© Ù…Ù„ÙØ§Øª ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª",
      compressUrlTitle: "Ø¶ØºØ· Ù…Ù† Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø©",
      compressUrlSubtitle: "Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· PDF Ù…Ø¨Ø§Ø´Ø± ÙˆØ³ÙŠØªÙ… Ø¶ØºØ·Ù‡ ÙˆØªÙ†Ø²ÙŠÙ„Ù‡",
      compressUrlLabel: "Ø±Ø§Ø¨Ø· Ù…Ù„Ù PDF",
      btnCompressUrl: "Ø¶ØºØ· Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·",
      hintSecure: "Ù„Ø§ ÙŠØªÙ… ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ù„ÙØ§Øª Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±",
      mergeTitle: "Ø¯Ù…Ø¬ Ù…Ù„ÙØ§Øª PDF",
      mergeSubtitle: "Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ Ø£Ùˆ Ù…Ù† Supabase Ø«Ù… Ø¯Ù…Ø¬Ù‡Ø§ Ø¨ØªØ±ØªÙŠØ¨ Ù…Ø®ØµØµ",
      mergeLocalTitle: "Ø¥Ø¶Ø§ÙØ© Ù…Ù„ÙØ§Øª Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²",
      mergeLocalSubtitle: "Ø§Ù„Ù…Ù„ÙØ§Øª Ø³ÙŠØªÙ… Ø±ÙØ¹Ù‡Ø§ Ø¥Ù„Ù‰ Supabase ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§",
      mergeDropTitle: "Ø§Ø³Ø­Ø¨ Ù…Ù„ÙØ§Øª PDF Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø¥Ø¶Ø§ÙØ©",
      mergeDropSub: "ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨Ù‡Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ù…Ø¬",
      mergeSupabaseTitle: "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Supabase",
      mergeSupabaseSubtitle: "Ø§Ø®ØªØ± Ù…Ù„ÙØ§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§ ÙÙŠ Ø§Ù„Ø¨Ø§ÙƒØª",
      btnMerge: "Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",
      btnRefresh: "ØªØ­Ø¯ÙŠØ«",
      splitTitle: "ØªÙ‚Ø³ÙŠÙ… / Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØµÙØ­Ø§Øª",
      splitSubtitle: "Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©",
      splitSourceTitle: "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±",
      splitSourceSubtitle: "Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² (Ù…Ø±ÙÙˆØ¹ Ø¥Ù„Ù‰ Supabase) Ø£Ùˆ Ù…Ù† Supabase Ù…Ø¨Ø§Ø´Ø±Ø©",
      btnChooseLocal: "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²",
      btnChooseSupabase: "ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase",
      splitPagesTitle: "ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙØ­Ø§Øª",
      splitPagesSubtitle: "Ù…Ø«Ø§Ù„: 1-3,5,7-8",
      splitPagesLabel: "Ù†Ø·Ø§Ù‚ Ø§Ù„ØµÙØ­Ø§Øª",
      btnExtractPages: "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",
      textTitle: "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ",
      textSubtitle: "Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Øµ Ù…Ù† Ù…Ù„ÙØ§Øª PDF ÙˆØ¹Ø±Ø¶Ù‡ Ø£Ùˆ ØªØ­Ù…ÙŠÙ„Ù‡ ÙƒÙ…Ù„Ù Ù†ØµÙŠ",
      textSourceTitle: "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±",
      btnExtractText: "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ",
      textOutputTitle: "Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬",
      btnCopyText: "Ù†Ø³Ø® Ø§Ù„Ù†Øµ",
      btnDownloadText: "ØªØ­Ù…ÙŠÙ„ ÙƒÙ…Ù„Ù TXT",
      infoTitle: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ù…Ù„Ù PDF",
      infoSubtitle: "Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§ØªØŒ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„ÙØŒ ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©",
      infoSourceTitle: "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±",
      btnGetInfo: "Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",
      infoDetailsTitle: "Ø§Ù„Ù†ØªÙŠØ¬Ø©",
      protectTitle: "Ø­Ù…Ø§ÙŠØ© / ÙÙƒ Ø§Ù„Ø­Ù…Ø§ÙŠØ©",
      protectSubtitle: "Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø© Ø­Ù…Ø§ÙŠØ© Ù…Ù†Ø·Ù‚ÙŠØ© Ø£Ùˆ Ø¥Ø²Ø§Ù„Ø© ØµÙØ­Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡",
      protectAddTitle: "Ø¥Ø¶Ø§ÙØ© Ø­Ù…Ø§ÙŠØ© (Ù…Ù†Ø·Ù‚ÙŠØ©)",
      protectPasswordLabel: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
      btnProtect: "Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ù…Ø­Ù…ÙŠØ©",
      unlockTitle: "ÙÙƒ Ø§Ù„Ø­Ù…Ø§ÙŠØ©",
      btnUnlock: "Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø¨Ø¯ÙˆÙ† Ø­Ù…Ø§ÙŠØ©",
      watermarkTitle: "Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© (Ù†Øµ)",
      watermarkSubtitle: "Ø¥Ø¶Ø§ÙØ© Ù†Øµ Ù…Ø§Ø¦Ù„ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª",
      watermarkSourceTitle: "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±",
      watermarkOptionsTitle: "Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©",
      watermarkTextLabel: "Ø§Ù„Ù†Øµ",
      watermarkColorLabel: "Ø§Ù„Ù„ÙˆÙ†",
      watermarkOpacityLabel: "Ø§Ù„Ø´ÙØ§ÙÙŠØ©",
      btnApplyWatermark: "ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©",
      rotateTitle: "ØªØ¯ÙˆÙŠØ± / Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙØ­Ø§Øª",
      rotateSubtitle: "ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ ÙÙŠ ØªØ±ØªÙŠØ¨ ÙˆØ§ØªØ¬Ø§Ù‡ Ø§Ù„ØµÙØ­Ø§Øª",
      rotateSourceTitle: "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±",
      rotateOptsTitle: "Ø§Ù„ØªØ¯ÙˆÙŠØ± ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨",
      rotateAngleLabel: "Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØªØ¯ÙˆÙŠØ±",
      rotatePagesLabel: "Ø§Ù„ØµÙØ­Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
      btnApplyRotate: "ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¯ÙˆÙŠØ±",
      reorderLabel: "ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙØ­Ø§Øª (Ù…Ø«Ø§Ù„: 3,1,2)",
      btnApplyReorder: "ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨",
      supaTitle: "Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Supabase",
      supaSubtitle: "Ø§Ø³ØªØ¹Ø±Ø§Ø¶ØŒ Ø¶ØºØ·ØŒ Ø­Ø°ÙØŒ ÙˆÙ†Ø³Ø® Ø§Ù„Ø±ÙˆØ§Ø¨Ø·",
      supaUploadTitle: "Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Supabase",
      supaDropTitle: "Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±",
      supaDropSub: "ÙŠØªÙ… Ø±ÙØ¹Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø§ÙƒØª pdf-files",
      supaListTitle: "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª",
      historyTitle: "Ø§Ù„Ø³Ø¬Ù„ Ùˆ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±",
      historySubtitle: "Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ù…Ù„ÙŠØ§ØªÙƒ ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ±ÙØ± ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ",
      historyOpsTitle: "Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª",
      btnClearHistory: "Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„",
      logsTitle: "Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«",
      btnClearLogs: "Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„",
    },
    en: {
      appTitle: "PDF Master Tool",
      appSubtitle: "A professional dashboard for all PDF tools",
      navMain: "Core operations",
      navCompress: "Compress",
      navMerge: "Merge",
      navSplit: "Split / Extract Pages",
      navText: "Extract Text",
      navInfo: "PDF Info",
      navAdvanced: "Advanced",
      navProtect: "Protect / Unlock",
      navWatermark: "Watermark",
      navRotate: "Rotate / Reorder",
      navSystem: "Files & System",
      navSupabase: "Supabase Files",
      navHistory: "History & Status",
      compressTitle: "Compress PDF files",
      compressSubtitle: "Upload, compress, and download PDFs efficiently",
      sectionPowered: "Powered by PDF PRO server",
      compressUploadTitle: "Upload & compress multiple files",
      compressUploadSubtitle: "Upload to Supabase then compress via server",
      compressDropTitle: "Drop PDF files here or click to select",
      compressDropSub: "Supports multiple files at once",
      compressUrlTitle: "Compress from direct URL",
      compressUrlSubtitle: "Paste a direct PDF URL and compress it",
      compressUrlLabel: "PDF URL",
      btnCompressUrl: "Compress PDF from URL",
      hintSecure: "Files are not permanently stored on the server",
      mergeTitle: "Merge PDF files",
      mergeSubtitle: "Choose files from device or Supabase and merge in custom order",
      mergeLocalTitle: "Add files from device",
      mergeLocalSubtitle: "Files will be uploaded to Supabase automatically",
      mergeDropTitle: "Drop PDF files or click to add",
      mergeDropSub: "You can reorder them before merging",
      mergeSupabaseTitle: "Pick from Supabase",
      mergeSupabaseSubtitle: "Use files already in the bucket",
      btnMerge: "Merge selected files",
      btnRefresh: "Refresh",
      splitTitle: "Split / Extract pages",
      splitSubtitle: "Create a new PDF with the pages you want",
      splitSourceTitle: "Choose source file",
      splitSourceSubtitle: "From your device or directly from Supabase",
      btnChooseLocal: "Choose from device",
      btnChooseSupabase: "Refresh Supabase list",
      splitPagesTitle: "Choose pages",
      splitPagesSubtitle: "Example: 1-3,5,7-8",
      splitPagesLabel: "Pages range",
      btnExtractPages: "Extract pages",
      textTitle: "Extract text",
      textSubtitle: "Read text from PDF and preview or download it",
      textSourceTitle: "Choose source file",
      btnExtractText: "Extract text",
      textOutputTitle: "Extracted text",
      btnCopyText: "Copy text",
      btnDownloadText: "Download as TXT",
      infoTitle: "PDF info",
      infoSubtitle: "Pages count, size, and basic info",
      infoSourceTitle: "Choose source file",
      btnGetInfo: "Get info",
      infoDetailsTitle: "Result",
      protectTitle: "Protect / Unlock",
      protectSubtitle: "Add a logical protection layer or remove it",
      protectAddTitle: "Add protection (logical)",
      protectPasswordLabel: "Password",
      btnProtect: "Create protected copy",
      unlockTitle: "Unlock",
      btnUnlock: "Create unlocked copy",
      watermarkTitle: "Watermark (text)",
      watermarkSubtitle: "Add slanted text on all pages",
      watermarkSourceTitle: "Choose source file",
      watermarkOptionsTitle: "Watermark options",
      watermarkTextLabel: "Text",
      watermarkColorLabel: "Color",
      watermarkOpacityLabel: "Opacity",
      btnApplyWatermark: "Apply watermark",
      rotateTitle: "Rotate / Reorder pages",
      rotateSubtitle: "Full control over pages orientation and order",
      rotateSourceTitle: "Choose source file",
      rotateOptsTitle: "Rotate & reorder",
      rotateAngleLabel: "Rotation angle",
      rotatePagesLabel: "Pages (optional)",
      btnApplyRotate: "Apply rotation",
      reorderLabel: "Pages order (example: 3,1,2)",
      btnApplyReorder: "Apply reorder",
      supaTitle: "Supabase files manager",
      supaSubtitle: "Browse, compress, delete, and copy URLs",
      supaUploadTitle: "Upload files to Supabase",
      supaDropTitle: "Drop files here or click to select",
      supaDropSub: "Uploaded directly into pdf-files bucket",
      supaListTitle: "Files list",
      historyTitle: "History & server status",
      historySubtitle: "Track your operations and server health in real-time",
      historyOpsTitle: "Operations history",
      btnClearHistory: "Clear history",
      logsTitle: "Events log",
      btnClearLogs: "Clear log",
    }
  };

  let currentLang = "ar";
  const statusDot = document.getElementById("statusDot");
  const statusText = document.getElementById("statusText");
  const historyList = document.getElementById("history-list");
  const logsConsole = document.getElementById("logs-console");

  function logMessage(message, type = "info") {
    const line = document.createElement("div");
    line.className = "log-line";
    const time = new Date().toLocaleTimeString();
    line.innerHTML = `<span>[${time}]</span> ${message}`;
    logsConsole.prepend(line);
  }

  function addHistoryEntry(type, fileName, success = true) {
    const entry = document.createElement("div");
    entry.className = "history-item";
    const main = document.createElement("div");
    main.className = "history-main";
    const t = document.createElement("div");
    t.className = "history-type";
    t.textContent = type;
    const meta = document.createElement("div");
    meta.className = "history-meta";
    meta.textContent = fileName;
    main.appendChild(t);
    main.appendChild(meta);
    const status = document.createElement("div");
    status.className = "history-status " + (success ? "success" : "error");
    status.textContent = success ? "OK" : "ERR";
    entry.appendChild(main);
    entry.appendChild(status);
    historyList.prepend(entry);
    while (historyList.children.length > 30) {
      historyList.removeChild(historyList.lastChild);
    }
  }

  async function checkHealth() {
    try {
      const res = await fetch(\`\${SERVER_BASE}/health\`);
      if (!res.ok) throw new Error("Health failed");
      const data = await res.json();
      statusDot.classList.add("online");
      statusText.textContent = data.message || "Online";
      logMessage("Server online", "info");
    } catch (e) {
      statusDot.classList.remove("online");
      statusText.textContent = currentLang === "ar" ? "ØºÙŠØ± Ù…ØªØµÙ„" : "Offline";
      logMessage("Server offline", "error");
    }
  }

  checkHealth();
  setInterval(checkHealth, 45000);

  function switchLanguage(lang) {
    currentLang = lang;
    document.querySelectorAll(".lang-btn").forEach(btn => {
      btn.classList.toggle("active", btn.dataset.lang === lang);
    });
    const dict = i18n[lang];
    document.querySelectorAll("[data-i18n]").forEach(el => {
      const key = el.getAttribute("data-i18n");
      if (dict[key]) el.textContent = dict[key];
    });
    document.body.dir = lang === "ar" ? "rtl" : "ltr";
  }

  document.querySelectorAll(".lang-btn").forEach(btn => {
    btn.addEventListener("click", () => switchLanguage(btn.dataset.lang));
  });

  switchLanguage("ar");

  document.querySelectorAll(".nav-item").forEach(item => {
    item.addEventListener("click", () => {
      const section = item.dataset.section;
      document.querySelectorAll(".nav-item").forEach(i => i.classList.toggle("active", i === item));
      document.querySelectorAll("main .section").forEach(sec => {
        sec.style.display = sec.id === \`section-\${section}\` ? "block" : "none";
      });
    });
  });

  async function uploadToSupabase(file) {
    const fileName = \`\${Date.now()}-\${file.name}\`;
    logMessage(\`Upload start: \${file.name}\`);
    const { data, error } = await supabase.storage.from(BUCKET_NAME).upload(fileName, file);
    if (error) {
      logMessage(\`Upload failed: \${file.name} - \${error.message}\`, "error");
      throw error;
    }
    const { data: pub } = supabase.storage.from(BUCKET_NAME).getPublicUrl(fileName);
    const publicUrl = pub.publicUrl;
    logMessage(\`Upload done: \${file.name}\`);
    return { fileName, publicUrl };
  }

  async function callBackendPdf(route, payload, downloadName) {
    const res = await fetch(\`\${SERVER_BASE}/\${route}\`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    if (!res.ok) {
      const txt = await res.text();
      throw new Error(txt || \`HTTP \${res.status}\`);
    }
    const blob = await res.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = downloadName;
    a.click();
    URL.revokeObjectURL(url);
  }

  async function callBackendJson(route, payload) {
    const res = await fetch(\`\${SERVER_BASE}/\${route}\`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    if (!res.ok) {
      const txt = await res.text();
      throw new Error(txt || \`HTTP \${res.status}\`);
    }
    return res.json();
  }

  function wireFileDrop(dropEl, inputEl, onFiles) {
    dropEl.addEventListener("click", () => inputEl.click());
    dropEl.addEventListener("dragover", e => {
      e.preventDefault();
      dropEl.classList.add("dragover");
    });
    dropEl.addEventListener("dragleave", () => dropEl.classList.remove("dragover"));
    dropEl.addEventListener("drop", e => {
      e.preventDefault();
      dropEl.classList.remove("dragover");
      if (e.dataTransfer.files && e.dataTransfer.files.length) {
        onFiles(e.dataTransfer.files);
      }
    });
    inputEl.addEventListener("change", e => {
      if (e.target.files && e.target.files.length) {
        onFiles(e.target.files);
      }
    });
  }

  const compressDrop = document.getElementById("compress-drop");
  const compressInput = document.getElementById("compress-input");
  const compressList = document.getElementById("compress-file-list");

  wireFileDrop(compressDrop, compressInput, handleCompressFiles);

  function createCompressItem(file) {
    const el = document.createElement("div");
    el.className = "file-item";
    el.innerHTML = \`
      <div class="file-item-header">
        <div class="file-name">\${file.name}</div>
        <div class="file-status"></div>
      </div>
      <div class="file-meta">
        <span>\${(file.size / (1024 * 1024)).toFixed(2)} MB</span>
      </div>
      <div class="file-progress">
        <div class="file-progress-bar"></div>
      </div>
    \`;
    return el;
  }

  async function handleCompressFiles(files) {
    for (const file of files) {
      const itemEl = createCompressItem(file);
      compressList.appendChild(itemEl);
      const statusEl = itemEl.querySelector(".file-status");
      const bar = itemEl.querySelector(".file-progress-bar");

      try {
        statusEl.textContent = currentLang === "ar" ? "Ø±ÙØ¹ Ø¥Ù„Ù‰ Supabase..." : "Uploading to Supabase...";
        bar.style.width = "20%";
        const { publicUrl } = await uploadToSupabase(file);

        statusEl.textContent = currentLang === "ar" ? "Ø¶ØºØ· Ø¹Ø¨Ø± Ø§Ù„Ø³ÙŠØ±ÙØ±..." : "Compressing via server...";
        bar.style.width = "60%";
        await callBackendPdf("compress", { publicUrl }, "compressed-" + file.name);

        statusEl.textContent = currentLang === "ar" ? "ØªÙ… Ø§Ù„ØªÙ†Ø²ÙŠÙ„" : "Downloaded";
        bar.style.width = "100%";
        addHistoryEntry("compress", file.name, true);
        logMessage(\`Compressed: \${file.name}\`);
      } catch (e) {
        statusEl.textContent = currentLang === "ar" ? "Ø®Ø·Ø£: " + e.message : "Error: " + e.message;
        bar.style.width = "100%";
        bar.style.background = "linear-gradient(to right, #f97373,#fb7185)";
        addHistoryEntry("compress", file.name, false);
        logMessage(\`Compress failed: \${file.name} - \${e.message}\`, "error");
      }
    }
  }

  const compressUrlInput = document.getElementById("compress-url-input");
  const compressUrlBtn = document.getElementById("compress-url-btn");

  compressUrlBtn.addEventListener("click", async () => {
    const url = compressUrlInput.value.trim();
    if (!url) return;
    logMessage(\`Compress from URL: \${url}\`);
    try {
      await callBackendPdf("compress", { publicUrl: url }, "compressed-from-url.pdf");
      addHistoryEntry("compress/url", url, true);
    } catch (e) {
      addHistoryEntry("compress/url", url, false);
      logMessage(\`Compress from URL failed: \${e.message}\`, "error");
      alert(e.message);
    }
  });

  const mergeDrop = document.getElementById("merge-drop");
  const mergeInput = document.getElementById("merge-input");
  const mergeFileList = document.getElementById("merge-file-list");
  const mergeSupaList = document.getElementById("merge-supabase-list");
  const mergeBtn = document.getElementById("merge-btn");
  const mergeRefreshSupa = document.getElementById("merge-refresh-supa");

  const mergeSources = [];

  wireFileDrop(mergeDrop, mergeInput, files => {
    for (const file of files) {
      const item = {
        type: "local",
        file,
        uploaded: false,
        publicUrl: null
      };
      mergeSources.push(item);
    }
    renderMergeList();
  });

  function renderMergeList() {
    mergeFileList.innerHTML = "";
    mergeSources.forEach((src, index) => {
      const el = document.createElement("div");
      el.className = "file-item";
      el.innerHTML = \`
        <div class="file-item-header">
          <div class="file-name">\${src.type === "local" ? src.file.name : src.fileName}</div>
          <div class="row">
            <button class="btn-secondary btn-sm" data-action="up">\u2191</button>
            <button class="btn-secondary btn-sm" data-action="down">\u2193</button>
            <button class="btn-danger btn-sm" data-action="remove">\u00d7</button>
          </div>
        </div>
        <div class="file-meta">
          <span>\${src.type}</span>
          <span>\${src.type === "local" ? (src.file.size / (1024 * 1024)).toFixed(2) + " MB" : ""}</span>
        </div>
      \`;
      el.querySelectorAll("button").forEach(btn => {
        btn.addEventListener("click", () => {
          const action = btn.dataset.action;
          if (action === "remove") {
            mergeSources.splice(index, 1);
          } else if (action === "up" && index > 0) {
            const tmp = mergeSources[index - 1];
            mergeSources[index - 1] = mergeSources[index];
            mergeSources[index] = tmp;
          } else if (action === "down" && index < mergeSources.length - 1) {
            const tmp = mergeSources[index + 1];
            mergeSources[index + 1] = mergeSources[index];
            mergeSources[index] = tmp;
          }
          renderMergeList();
        });
      });
      mergeFileList.appendChild(el);
    });
  }

  async function loadSupabaseList(targetEl, onAction) {
    targetEl.innerHTML = "";
    const { data, error } = await supabase.storage.from(BUCKET_NAME).list();
    if (error) {
      targetEl.textContent = error.message;
      return;
    }
    data.forEach(file => {
      const { data: pub } = supabase.storage.from(BUCKET_NAME).getPublicUrl(file.name);
      const publicUrl = pub.publicUrl;

      const el = document.createElement("div");
      el.className = "file-item";
      el.innerHTML = \`
        <div class="file-item-header">
          <div class="file-name">\${file.name}</div>
          <div class="row">
            <button class="btn-secondary btn-sm" data-act="select">\${currentLang === "ar" ? "Ø§Ø®ØªÙŠØ§Ø±" : "Select"}</button>
          </div>
        </div>
        <div class="file-meta">
          <span>\${publicUrl.slice(0, 40)}...</span>
        </div>
      \`;
      el.querySelector("button").addEventListener("click", () => {
        onAction({ fileName: file.name, publicUrl });
      });
      targetEl.appendChild(el);
    });
  }

  mergeRefreshSupa.addEventListener("click", () => {
    loadSupabaseList(mergeSupaList, ({ fileName, publicUrl }) => {
      mergeSources.push({ type: "supabase", fileName, publicUrl });
      renderMergeList();
    });
  });

  mergeBtn.addEventListener("click", async () => {
    if (mergeSources.length < 2) {
      alert(currentLang === "ar" ? "Ø§Ø®ØªØ± Ù…Ù„ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„" : "Select at least two files");
      return;
    }
    try {
      const urls = [];
      for (const src of mergeSources) {
        if (src.type === "local") {
          const { publicUrl } = await uploadToSupabase(src.file);
          src.publicUrl = publicUrl;
        }
        urls.push(src.publicUrl);
      }
      await callBackendPdf("merge", { publicUrls: urls }, "merged.pdf");
      addHistoryEntry("merge", urls.length + " files", true);
    } catch (e) {
      addHistoryEntry("merge", "error", false);
      logMessage("Merge failed: " + e.message, "error");
      alert(e.message);
    }
  });

  const splitLocalBtn = document.getElementById("split-local-btn");
  const splitSupaRefresh = document.getElementById("split-supa-refresh");
  const splitInput = document.getElementById("split-input");
  const splitSupaList = document.getElementById("split-supa-list");
  const splitPagesInput = document.getElementById("split-pages-input");
  const splitExtractBtn = document.getElementById("split-extract-btn");

  let splitPublicUrl = null;
  let splitName = null;

  splitLocalBtn.addEventListener("click", () => splitInput.click());
  splitInput.addEventListener("change", async e => {
    const f = e.target.files[0];
    if (!f) return;
    try {
      const { publicUrl } = await uploadToSupabase(f);
      splitPublicUrl = publicUrl;
      splitName = f.name;
      splitSupaList.innerHTML = "";
      const el = document.createElement("div");
      el.className = "file-item";
      el.innerHTML = \`<div class="file-item-header"><div class="file-name">\${f.name}</div></div>\`;
      splitSupaList.appendChild(el);
    } catch (err) {
      alert(err.message);
    }
  });

  splitSupaRefresh.addEventListener("click", () => {
    loadSupabaseList(splitSupaList, ({ fileName, publicUrl }) => {
      splitPublicUrl = publicUrl;
      splitName = fileName;
      splitSupaList.innerHTML = "";
      const el = document.createElement("div");
      el.className = "file-item";
      el.innerHTML = \`<div class="file-item-header"><div class="file-name">\${fileName}</div></div>\`;
      splitSupaList.appendChild(el);
    });
  });

  splitExtractBtn.addEventListener("click", async () => {
    if (!splitPublicUrl) {
      alert(currentLang === "ar" ? "Ø§Ø®ØªØ± Ù…Ù„ÙÙ‹Ø§ Ø£ÙˆÙ„Ù‹Ø§" : "Select a file first");
      return;
    }
    const pages = splitPagesInput.value.trim();
    if (!pages) return;
    try {
      await callBackendPdf("extract-pages", { publicUrl: splitPublicUrl, pages }, "extracted-" + (splitName || "pages") + ".pdf");
      addHistoryEntry("extract-pages", splitName || "file", true);
    } catch (e) {
      addHistoryEntry("extract-pages", splitName || "file", false);
      logMessage("Extract pages failed: " + e.message, "error");
      alert(e.message);
    }
  });

  const textLocalBtn = document.getElementById("text-local-btn");
  const textSupaRefresh = document.getElementById("text-supa-refresh");
  const textInput = document.getElementById("text-input");
  const textSupaList = document.getElementById("text-supa-list");
  const textExtractBtn = document.getElementById("text-extract-btn");
  const textOutput = document.getElementById("text-output");
  const textCopyBtn = document.getElementById("text-copy-btn");
  const textDownloadBtn = document.getElementById("text-download-btn");

  let textPublicUrl = null;
  let textName = null;
  let lastExtractedText = "";

  textLocalBtn.addEventListener("click", () => textInput.click());
  textInput.addEventListener("change", async e => {
    const f = e.target.files[0];
    if (!f) return;
    try {
      const { publicUrl } = await uploadToSupabase(f);
      textPublicUrl = publicUrl;
      textName = f.name;
      textSupaList.innerHTML = "";
      const el = document.createElement("div");
      el.className = "file-item";
      el.innerHTML = \`<div class="file-item-header"><div class="file-name">\${f.name}</div></div>\`;
      textSupaList.appendChild(el);
    } catch (err) {
      alert(err.message);
    }
  });

  textSupaRefresh.addEventListener("click", () => {
    loadSupabaseList(textSupaList, ({ fileName, publicUrl }) => {
      textPublicUrl = publicUrl;
      textName = fileName;
      textSupaList.innerHTML = "";
      const el = document.createElement("div");
      el.className = "file-item";
      el.innerHTML = \`<div class="file-item-header"><div class="file-name">\${fileName}</div></div>\`;
      textSupaList.appendChild(el);
    });
  });

  textExtractBtn.addEventListener("click", async () => {
    if (!textPublicUrl) {
      alert(currentLang === "ar" ? "Ø§Ø®ØªØ± Ù…Ù„ÙÙ‹Ø§ Ø£ÙˆÙ„Ù‹Ø§" : "Select a file first");
      return;
    }
    try {
      const data = await callBackendJson("extract-text", { publicUrl: textPublicUrl });
      lastExtractedText = data.text || "";
      textOutput.textContent = lastExtractedText;
      addHistoryEntry("extract-text", textName || "file", true);
    } catch (e) {
      addHistoryEntry("extract-text", textName || "file", false);
      logMessage("Extract text failed: " + e.message, "error");
      alert(e.message);
    }
  });

  textCopyBtn.addEventListener("click", async () => {
    if (!lastExtractedText) return;
    try {
      await navigator.clipboard.writeText(lastExtractedText);
      logMessage("Text copied");
    } catch {}
  });

  textDownloadBtn.addEventListener("click", () => {
    if (!lastExtractedText) return;
    const blob = new Blob([lastExtractedText], { type: "text/plain;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = (textName || "extracted") + ".txt";
    a.click();
    URL.revokeObjectURL(url);
  });

  const infoLocalBtn = document.getElementById("info-local-btn");
const infoSupaRefresh = document.getElementById("info-supa-refresh");
const infoInput = document.getElementById("info-input");
const infoSupaList = document.getElementById("info-supa-list");

// ØªØ­Ù…ÙŠÙ„ Ù…Ù„ÙØ§Øª Supabase Ø¯Ø§Ø®Ù„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
async function loadInfoSupabaseFiles() {
  infoSupaList.innerHTML = "<option>Loading...</option>";

  const { data, error } = await supabase.storage
    .from(BUCKET_NAME)
    .list();

  if (error) {
    infoSupaList.innerHTML = "<option>Error loading files</option>";
    return;
  }

  infoSupaList.innerHTML = "<option value=''>Ø§Ø®ØªØ± Ù…Ù„Ù</option>";

  data.forEach(file => {
    const opt = document.createElement("option");
    opt.value = file.name;
    opt.textContent = file.name;
    infoSupaList.appendChild(opt);
  });
}

// Ø²Ø± ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase
infoSupaRefresh.addEventListener("click", loadInfoSupabaseFiles);

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ publicUrl Ù„Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªØ§Ø±
async function getInfoPublicUrl() {
  // Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø­Ù„ÙŠ
  if (infoLocalBtn.checked) {
    const file = infoInput.files[0];
    if (!file) {
      alert("Ø§Ø®ØªØ± Ù…Ù„Ù PDF Ø£ÙˆÙ„Ø§Ù‹");
      return null;
    }

    const fileName = `${Date.now()}-${file.name}`;
    const { error } = await supabase.storage
      .from(BUCKET_NAME)
      .upload(fileName, file);

    if (error) {
      alert("ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù");
      return null;
    }

    const { data } = supabase.storage
      .from(BUCKET_NAME)
      .getPublicUrl(fileName);

    return data.publicUrl;
  }

  // Ù…Ù† Supabase
  const selected = infoSupaList.value;
  if (!selected) {
    alert("Ø§Ø®ØªØ± Ù…Ù„Ù Ù…Ù† Supabase");
    return null;
  }

  const { data } = supabase.storage
    .from(BUCKET_NAME)
    .getPublicUrl(selected);

  return data.publicUrl;
}

// Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª PDF Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
async function fetchPdfInfo(publicUrl) {
  const response = await fetch(`${SERVER_BASE}/info`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ publicUrl })
  });

  if (!response.ok) {
    throw new Error("ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù");
  }

  return await response.json();
}

// Ø²Ø± ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
document.getElementById("info-fetch-btn").addEventListener("click", async () => {
  const resultBox = document.getElementById("info-result");
  resultBox.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

  try {
    const publicUrl = await getInfoPublicUrl();
    if (!publicUrl) return;

    const info = await fetchPdfInfo(publicUrl);

    resultBox.innerHTML = `
      <div class="info-card">
        <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª:</strong> ${info.pages}</p>
        <p><strong>Ø§Ù„Ø­Ø¬Ù…:</strong> ${info.sizeMB} MB</p>
        <p><strong>Ø§Ù„Ø­Ø¬Ù… Ø¨Ø§Ù„Ø¨Ø§ÙŠØª:</strong> ${info.sizeBytes}</p>
      </div>
    `;
  } catch (err) {
    resultBox.innerHTML = `<span style="color:red;">${err.message}</span>`;
  }
});
// ===============================
// âœ… Protect PDF
// ===============================

const protectBtn = document.getElementById("protect-btn");
const protectPassword = document.getElementById("protect-password");
const protectLocalBtn = document.getElementById("protect-local-btn");
const protectInput = document.getElementById("protect-input");
const protectSupaList = document.getElementById("protect-supa-list");
const protectSupaRefresh = document.getElementById("protect-supa-refresh");

protectLocalBtn.addEventListener("change", () => {
  protectInput.style.display = "block";
  protectSupaList.style.display = "none";
});

document.getElementById("protect-supa-btn").addEventListener("change", () => {
  protectInput.style.display = "none";
  protectSupaList.style.display = "block";
  loadProtectSupabaseFiles();
});

async function loadProtectSupabaseFiles() {
  protectSupaList.innerHTML = "<option>Loading...</option>";

  const { data } = await supabase.storage.from(BUCKET_NAME).list();

  protectSupaList.innerHTML = "<option value=''>Ø§Ø®ØªØ± Ù…Ù„Ù</option>";
  data.forEach(f => {
    const opt = document.createElement("option");
    opt.value = f.name;
    opt.textContent = f.name;
    protectSupaList.appendChild(opt);
  });
}

protectSupaRefresh.addEventListener("click", loadProtectSupabaseFiles);

async function getProtectPublicUrl() {
  if (protectLocalBtn.checked) {
    const file = protectInput.files[0];
    if (!file) return null;

    const fileName = `${Date.now()}-${file.name}`;
    await supabase.storage.from(BUCKET_NAME).upload(fileName, file);

    const { data } = supabase.storage.from(BUCKET_NAME).getPublicUrl(fileName);
    return data.publicUrl;
  }

  const selected = protectSupaList.value;
  if (!selected) return null;

  const { data } = supabase.storage.from(BUCKET_NAME).getPublicUrl(selected);
  return data.publicUrl;
}

protectBtn.addEventListener("click", async () => {
  const password = protectPassword.value.trim();
  if (!password) return alert("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±");

  const publicUrl = await getProtectPublicUrl();
  if (!publicUrl) return alert("Ø§Ø®ØªØ± Ù…Ù„Ù");

  const response = await fetch(`${SERVER_BASE}/protect`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ publicUrl, password })
  });

  const blob = await response.blob();
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "protected.pdf";
  a.click();
  URL.revokeObjectURL(url);
});


// ===============================
// âœ… Unlock PDF
// ===============================

const unlockBtn = document.getElementById("unlock-btn");
const unlockLocalBtn = document.getElementById("unlock-local-btn");
const unlockInput = document.getElementById("unlock-input");
const unlockSupaList = document.getElementById("unlock-supa-list");
const unlockSupaRefresh = document.getElementById("unlock-supa-refresh");

unlockLocalBtn.addEventListener("change", () => {
  unlockInput.style.display = "block";
  unlockSupaList.style.display = "none";
});

document.getElementById("unlock-supa-btn").addEventListener("change", () => {
  unlockInput.style.display = "none";
  unlockSupaList.style.display = "block";
  loadUnlockSupabaseFiles();
});

async function loadUnlockSupabaseFiles() {
  unlockSupaList.innerHTML = "<option>Loading...</option>";

  const { data } = await supabase.storage.from(BUCKET_NAME).list();

  unlockSupaList.innerHTML = "<option value=''>Ø§Ø®ØªØ± Ù…Ù„Ù</option>";
  data.forEach(f => {
    const opt = document.createElement("option");
    opt.value = f.name;
    opt.textContent = f.name;
    unlockSupaList.appendChild(opt);
  });
}

unlockSupaRefresh.addEventListener("click", loadUnlockSupabaseFiles);

async function getUnlockPublicUrl() {
  if (unlockLocalBtn.checked) {
    const file = unlockInput.files[0];
    if (!file) return null;

    const fileName = `${Date.now()}-${file.name}`;
    await supabase.storage.from(BUCKET_NAME).upload(fileName, file);

    const { data } = supabase.storage.from(BUCKET_NAME).getPublicUrl(fileName);
    return data.publicUrl;
  }

  const selected = unlockSupaList.value;
  if (!selected) return null;

  const { data } = supabase.storage.from(BUCKET_NAME).getPublicUrl(selected);
  return data.publicUrl;
}

unlockBtn.addEventListener("click", async () => {
  const publicUrl = await getUnlockPublicUrl();
  if (!publicUrl) return alert("Ø§Ø®ØªØ± Ù…Ù„Ù");

  const response = await fetch(`${SERVER_BASE}/unlock`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ publicUrl })
  });

  const blob = await response.blob();
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "unlocked.pdf";
  a.click();
  URL.revokeObjectURL(url);
});


// ===============================
// âœ… Watermark Text
// ===============================

const watermarkBtn = document.getElementById("watermark-btn");
const watermarkText = document.getElementById("watermark-text");
const watermarkColor = document.getElementById("watermark-color");
const watermarkOpacity = document.getElementById("watermark-opacity");
const watermarkLocalBtn = document.getElementById("watermark-local-btn");
const watermarkInput = document.getElementById("watermark-input");
const watermarkSupaList = document.getElementById("watermark-supa-list");
const watermarkSupaRefresh = document.getElementById("watermark-supa-refresh");

watermarkLocalBtn.addEventListener("change", () => {
  watermarkInput.style.display = "block";
  watermarkSupaList.style.display = "none";
});

document.getElementById("watermark-supa-btn").addEventListener("change", () => {
  watermarkInput.style.display = "none";
  watermarkSupaList.style.display = "block";
  loadWatermarkSupabaseFiles();
});

async function loadWatermarkSupabaseFiles() {
  watermarkSupaList.innerHTML = "<option>Loading...</option>";

  const { data } = await supabase.storage.from(BUCKET_NAME).list();

  watermarkSupaList.innerHTML = "<option value=''>Ø§Ø®ØªØ± Ù…Ù„Ù</option>";
  data.forEach(f => {
    const opt = document.createElement("option");
    opt.value = f.name;
    opt.textContent = f.name;
    watermarkSupaList.appendChild(opt);
  });
}

watermarkSupaRefresh.addEventListener("click", loadWatermarkSupabaseFiles);

async function getWatermarkPublicUrl() {
  if (watermarkLocalBtn.checked) {
    const file = watermarkInput.files[0];
    if (!file) return null;

    const fileName = `${Date.now()}-${file.name}`;
    await supabase.storage.from(BUCKET_NAME).upload(fileName, file);

    const { data } = supabase.storage.from(BUCKET_NAME).getPublicUrl(fileName);
    return data.publicUrl;
  }

  const selected = watermarkSupaList.value;
  if (!selected) return null;

  const { data } = supabase.storage.from(BUCKET_NAME).getPublicUrl(selected);
  return data.publicUrl;
}

watermarkBtn.addEventListener("click", async () => {
  const text = watermarkText.value.trim();
  if (!text) return alert("Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©");

  const publicUrl = await getWatermarkPublicUrl();
  if (!publicUrl) return alert("Ø§Ø®ØªØ± Ù…Ù„Ù");

  const payload = {
    publicUrl,
    text,
    color: watermarkColor.value,
    opacity: parseFloat(watermarkOpacity.value)
  };

  const response = await fetch(`${SERVER_BASE}/watermark-text`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  const blob = await response.blob();
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "watermarked.pdf";
  a.click();
  URL.revokeObjectURL(url);
});


// ===============================
// âœ… Rotate Pages
// ===============================

const rotateBtn = document.getElementById("rotate-btn");
const rotateAngle = document.getElementById("rotate-angle");
const rotatePages = document.getElementById("rotate-pages");
const rotateLocalBtn = document.getElementById("rotate-local-btn");
const rotateInput = document.getElementById("rotate-input");
const rotateSupaList = document.getElementById("rotate-supa-list");
const rotateSupaRefresh = document.getElementById("rotate-supa-refresh");

rotateLocalBtn.addEventListener("change", () => {
  rotateInput.style.display = "block";
  rotateSupaList.style.display = "none";
});

document.getElementById("rotate-supa-btn").addEventListener("change", () => {
  rotateInput.style.display = "none";
  rotateSupaList.style.display = "block";
  loadRotateSupabaseFiles();
});

async function loadRotateSupabaseFiles() {
  rotateSupaList.innerHTML = "<option>Loading...</option>";

  const { data } = await supabase.storage.from(BUCKET_NAME).list();

  rotateSupaList.innerHTML = "<option value=''>Ø§Ø®ØªØ± Ù…Ù„Ù</option>";
  data.forEach(f => {
    const opt = document.createElement("option");
    opt.value = f.name;
    opt.textContent = f.name;
    rotateSupaList.appendChild(opt);
  });
}

rotateSupaRefresh.addEventListener("click", loadRotateSupabaseFiles);

async function getRotatePublicUrl() {
  if (rotateLocalBtn.checked) {
    const file = rotateInput.files[0];
    if (!file) return null;

    const fileName = `${Date.now()}-${file.name}`;
    await supabase.storage.from(BUCKET_NAME).upload(fileName, file);

    const { data } = supabase.storage.from(BUCKET_NAME).getPublicUrl(fileName);
    return data.publicUrl;
  }

  const selected = rotateSupaList.value;
  if (!selected) return null;

  const { data } = supabase.storage.from(BUCKET_NAME).getPublicUrl(selected);
  return data.publicUrl;
}

rotateBtn.addEventListener("click", async () => {
  const angle = parseInt(rotateAngle.value);
  const pages = rotatePages.value.trim();

  const publicUrl = await getRotatePublicUrl();
  if (!publicUrl) return alert("Ø§Ø®ØªØ± Ù…Ù„Ù");

  const payload = { publicUrl, angle };
  if (pages) payload.pages = pages;

  const response = await fetch(`${SERVER_BASE}/rotate-pages`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  const blob = await response.blob();
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "rotated.pdf";
  a.click();
  URL.revokeObjectURL(url);
});


// ===============================
// âœ… Reorder Pages
// ===============================

const reorderBtn = document.getElementById("reorder-btn");
const reorderOrder = document.getElementById("reorder-order");
const reorderLocalBtn = document.getElementById("reorder-local-btn");
const reorderInput = document.getElementById("reorder-input");
const reorderSupaList = document.getElementById("reorder-supa-list");
const reorderSupaRefresh = document.getElementById("reorder-supa-refresh");

reorderLocalBtn.addEventListener("change", () => {
  reorderInput.style.display = "block";
  reorderSupaList.style.display = "none";
});

document.getElementById("reorder-supa-btn").addEventListener("change", () => {
  reorderInput.style.display = "none";
  reorderSupaList.style.display = "block";
  loadReorderSupabaseFiles();
});

async function loadReorderSupabaseFiles() {
  reorderSupaList.innerHTML = "<option>Loading...</option>";

  const { data } = await supabase.storage.from(BUCKET_NAME).list();

  reorderSupaList.innerHTML = "<option value=''>Ø§Ø®ØªØ± Ù…Ù„Ù</option>";
  data.forEach(f => {
    const opt = document.createElement("option");
    opt.value = f.name;
    opt.textContent = f.name;
    reorderSupaList.appendChild(opt);
  });
}

reorderSupaRefresh.addEventListener("click", loadReorderSupabaseFiles);

async function getReorderPublicUrl() {
  if (reorderLocalBtn.checked) {
    const file = reorderInput.files[0];
    if (!file) return null;

    const fileName = `${Date.now()}-${file.name}`;
    await supabase.storage.from(BUCKET_NAME).upload(fileName, file);

    const { data } = supabase.storage.from(BUCKET_NAME).getPublicUrl(fileName);
    return data.publicUrl;
  }

  const selected = reorderSupaList.value;
  if (!selected) return null;

  const { data } = supabase.storage.from(BUCKET_NAME).getPublicUrl(selected);
  return data.publicUrl;
}

reorderBtn.addEventListener("click", async () => {
  const orderStr = reorderOrder.value.trim();
  if (!orderStr) return alert("Ø£Ø¯Ø®Ù„ ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙØ­Ø§Øª");

  const order = orderStr.split(",").map(n => parseInt(n.trim()));

  const publicUrl = await getReorderPublicUrl();
  if (!publicUrl) return alert("Ø§Ø®ØªØ± Ù…Ù„Ù");

  const response = await fetch(`${SERVER_BASE}/reorder-pages`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ publicUrl, order })
  });

  const blob = await response.blob();
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "reordered.pdf";
  a.click();
  URL.revokeObjectURL(url);
});


// ===============================
// âœ… Supabase File Manager
// ===============================

const supaListContainer = document.getElementById("supa-list");
const supaRefreshBtn = document.getElementById("supa-refresh");

async function loadSupabaseManager() {
  supaListContainer.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";

  const { data } = await supabase.storage.from(BUCKET_NAME).list();

  supaListContainer.innerHTML = "";

  data.forEach(file => {
    const row = document.createElement("div");
    row.className = "supa-row";

    row.innerHTML = `
      <span>${file.name}</span>
      <button class="mini-btn" data-action="copy" data-name="${file.name}">Ù†Ø³Ø®</button>
      <button class="mini-btn" data-action="compress" data-name="${file.name}">Ø¶ØºØ·</button>
      <button class="mini-btn" data-action="info" data-name="${file.name}">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</button>
      <button class="mini-btn danger" data-action="delete" data-name="${file.name}">Ø­Ø°Ù</button>
    `;

    supaListContainer.appendChild(row);
  });
}

supaRefreshBtn.addEventListener("click", loadSupabaseManager);

supaListContainer.addEventListener("click", async (e) => {
  const btn = e.target;
  if (!btn.dataset.action) return;

  const name = btn.dataset.name;
  const action = btn.dataset.action;

  const { data } = supabase.storage.from(BUCKET_NAME).getPublicUrl(name);
  const publicUrl = data.publicUrl;

  if (action === "copy") {
    navigator.clipboard.writeText(publicUrl);
    alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·");
  }

  if (action === "compress") {
    const response = await fetch(`${SERVER_BASE}/compress`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ publicUrl })
    });

    const blob = await response.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "compressed.pdf";
    a.click();
    URL.revokeObjectURL(url);
  }

  if (action === "info") {
    const response = await fetch(`${SERVER_BASE}/info`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ publicUrl })
    });

    const info = await response.json();
    alert(`Ø§Ù„ØµÙØ­Ø§Øª: ${info.pages}\nØ§Ù„Ø­Ø¬Ù…: ${info.sizeMB} MB`);
  }

  if (action === "delete") {
    await supabase.storage.from(BUCKET_NAME).remove([name]);
    loadSupabaseManager();
  }
});


// ===============================
// âœ… History & Logs
// ===============================

const historyList = document.getElementById("history-list");
const clearHistoryBtn = document.getElementById("clear-history");
const logsBox = document.getElementById("logs-box");
const clearLogsBtn = document.getElementById("clear-logs");

let historyData = [];
let logsData = [];

function addHistory(entry) {
  historyData.unshift(entry);
  if (historyData.length > 30) historyData.pop();
  renderHistory();
}

function renderHistory() {
  historyList.innerHTML = "";
  historyData.forEach(h => {
    const div = document.createElement("div");
    div.className = "history-item";
    div.innerHTML = `<strong>${h.type}</strong> - ${h.file} - ${h.time}`;
    historyList.appendChild(div);
  });
}

clearHistoryBtn.addEventListener("click", () => {
  historyData = [];
  renderHistory();
});

// ===============================
// âœ… History & Logs
// ===============================

const historyList = document.getElementById("history-list");
const clearHistoryBtn = document.getElementById("clear-history");
const logsBox = document.getElementById("logs-box");
const clearLogsBtn = document.getElementById("clear-logs");

let historyData = [];
let logsData = [];

function addHistory(entry) {
  historyData.unshift(entry);
  if (historyData.length > 30) historyData.pop();
  renderHistory();
}

function renderHistory() {
  historyList.innerHTML = "";
  historyData.forEach(h => {
    const div = document.createElement("div");
    div.className = "history-item";
    div.innerHTML = `<strong>${h.type}</strong> - ${h.file} - ${h.time}`;
    historyList.appendChild(div);
  });
}

clearHistoryBtn.addEventListener("click", () => {
  historyData = [];
  renderHistory();
});

function log(msg) {
  const time = new Date().toLocaleTimeString();
  logsData.unshift(`[${time}] ${msg}`);
  if (logsData.length > 200) logsData.pop();
  renderLogs();
}

function renderLogs() {
  logsBox.innerHTML = logsData.join("<br>");
}

clearLogsBtn.addEventListener("click", () => {
  logsData = [];
  renderLogs();
});

// ===============================
// âœ… Server Health Check
// ===============================

const serverStatus = document.getElementById("server-status");

async function checkServerHealth() {
  try {
    const res = await fetch(`${SERVER_BASE}/health`);
    if (!res.ok) throw new Error();

    serverStatus.textContent = "Online âœ…";
    serverStatus.style.color = "#4caf50";
  } catch {
    serverStatus.textContent = "Offline âŒ";
    serverStatus.style.color = "#ff5252";
  }
}

setInterval(checkServerHealth, 15000);
checkServerHealth();

// ===============================
// âœ… Navigation Switching
// ===============================

const sections = document.querySelectorAll(".tool-section");
const navButtons = document.querySelectorAll(".nav-btn");

navButtons.forEach(btn => {
  btn.addEventListener("click", () => {
    const target = btn.dataset.target;

    sections.forEach(sec => sec.style.display = "none");
    document.getElementById(target).style.display = "block";

    navButtons.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
  });
});

// ===============================
// âœ… Language Switching
// ===============================

const langSwitch = document.getElementById("lang-switch");

langSwitch.addEventListener("click", () => {
  const current = document.documentElement.getAttribute("lang") || "ar";
  const next = current === "ar" ? "en" : "ar";
  document.documentElement.setAttribute("lang", next);
  applyTranslations(next);
});

function applyTranslations(lang) {
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.dataset.i18n;
    if (i18n[lang] && i18n[lang][key]) {
      el.textContent = i18n[lang][key];
    }
  });
}

// ===============================
// âœ… Initial Load
// ===============================

document.getElementById("compress-section").style.display = "block";
applyTranslations("ar");

log("âœ… ÙˆØ§Ø¬Ù‡Ø© PDF Master Tool Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¹Ù…Ù„");
</script>
</body>
</html>

  
