<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>PDF Master Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg: #0f1014;
      --bg-alt: #181a20;
      --accent: #2dd4ff;
      --accent-soft: rgba(45, 212, 255, 0.15);
      --danger: #ff4d4f;
      --success: #22c55e;
      --text: #f9fafb;
      --muted: #9ca3af;
      --border: #272a33;
      --radius-lg: 16px;
      --radius-md: 10px;
      --radius-sm: 6px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #020617 55%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .app {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .app-header {
      position: sticky;
      top: 0;
      z-index: 20;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 18px;
      background: linear-gradient(to right, #020617dd, #020617f5);
      border-bottom: 1px solid var(--border);
      backdrop-filter: blur(12px);
    }

    .app-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 20%, #ffffff 0, #60a5fa 30%, #0ea5e9 55%, #020617 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 16px;
      color: #020617;
      box-shadow: 0 0 20px rgba(56,189,248,0.5);
    }

    .title-text-main {
      font-weight: 700;
      font-size: 18px;
    }

    .title-text-sub {
      font-size: 12px;
      color: var(--muted);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .lang-toggle {
      display: flex;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #020617;
      overflow: hidden;
    }

    .lang-btn {
      padding: 5px 10px;
      font-size: 12px;
      cursor: pointer;
      border: none;
      background: transparent;
      color: var(--muted);
      min-width: 40px;
      text-align: center;
    }

    .lang-btn.active {
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 600;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid var(--border);
      font-size: 11px;
      color: var(--muted);
    }

    .status-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: var(--danger);
    }

    .status-dot.online {
      background: var(--success);
      box-shadow: 0 0 8px rgba(34,197,94,0.8);
    }

    .layout {
      flex: 1;
      display: flex;
      min-height: 0;
    }

    .sidebar {
      width: 250px;
      background: linear-gradient(to bottom, #020617, #020617ee);
      border-inline-end: 1px solid var(--border);
      padding: 14px 10px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .sidebar-section-title {
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
      margin: 4px 6px;
    }

    .nav-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .nav-item {
      border-radius: var(--radius-md);
      padding: 8px 10px;
      cursor: pointer;
      font-size: 13px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.15s, color 0.15s, transform 0.1s;
    }

    .nav-item span {
      display: flex;
      align-items: center;
      gap: 7px;
    }

    .nav-item:hover {
      background: #020617;
      color: var(--text);
      transform: translateY(-1px);
    }

    .nav-item.active {
      background: var(--accent-soft);
      color: var(--accent);
      border: 1px solid rgba(45,212,255,0.5);
    }

    .nav-pill {
      font-size: 10px;
      padding: 1px 6px;
      border-radius: 999px;
      background: #111827;
      color: var(--muted);
    }

    .main {
      flex: 1;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow: auto;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
    }

    .section-subtitle {
      font-size: 12px;
      color: var(--muted);
    }

    .section-badge {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #020617;
      color: var(--muted);
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.2fr);
      gap: 12px;
    }

    .card {
      background: linear-gradient(to bottom right, #020617f2, #020617ea);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: 14px 14px 16px;
      box-shadow: 0 14px 40px rgba(15,23,42,0.9);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at top left, rgba(56,189,248,0.05) 0, transparent 50%);
      pointer-events: none;
    }

    .card-header {
      position: relative;
      z-index: 1;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
    }

    .card-subtitle {
      font-size: 11px;
      color: var(--muted);
    }

    .card-badge {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #020617;
      color: var(--muted);
    }

    .card-body {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
    }

    .input-label {
      color: var(--muted);
      font-size: 11px;
    }

    .input {
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: #020617;
      padding: 6px 8px;
      color: var(--text);
      font-size: 13px;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
    }

    .input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(45,212,255,0.5);
    }

    .input::placeholder {
      color: #4b5563;
    }

    textarea.input {
      resize: vertical;
      min-height: 70px;
      max-height: 200px;
    }

    .btn {
      border-radius: var(--radius-md);
      border: 1px solid transparent;
      padding: 7px 10px;
      font-size: 13px;
      cursor: pointer;
      background: var(--accent);
      color: #020617;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: background 0.15s, transform 0.1s, box-shadow 0.15s;
    }

    .btn:hover {
      background: #22c1f6;
      transform: translateY(-1px);
      box-shadow: 0 12px 30px rgba(37, 99, 235, 0.5);
    }

    .btn:disabled {
      opacity: 0.45;
      cursor: default;
      transform: none;
      box-shadow: none;
    }

    .btn-secondary {
      background: #020617;
      color: var(--muted);
      border-color: var(--border);
    }

    .btn-secondary:hover {
      background: #020617;
      color: var(--text);
      box-shadow: 0 12px 30px rgba(15,23,42,0.9);
    }

    .btn-danger {
      background: var(--danger);
      color: #fff;
    }

    .btn-danger:hover {
      background: #f97373;
      box-shadow: 0 12px 30px rgba(248,113,113,0.6);
    }

    .btn-sm {
      padding: 4px 7px;
      font-size: 11px;
    }

    .btn-icon {
      width: 26px;
      height: 26px;
      padding: 0;
      border-radius: 999px;
    }

    .file-drop {
      border-radius: var(--radius-lg);
      border: 1px dashed rgba(45,212,255,0.5);
      background: radial-gradient(circle at top left, rgba(45,212,255,0.06), #020617dd);
      padding: 18px 10px;
      text-align: center;
      cursor: pointer;
      transition: border 0.15s, background 0.15s, transform 0.1s;
      font-size: 13px;
      color: var(--muted);
    }

    .file-drop:hover,
    .file-drop.dragover {
      border-color: var(--accent);
      background: radial-gradient(circle at top left, rgba(45,212,255,0.12), #020617f0);
      transform: translateY(-1px);
    }

    .file-drop-title {
      font-size: 13px;
      color: var(--text);
      margin-bottom: 4px;
    }

    .file-drop-sub {
      font-size: 11px;
      color: var(--muted);
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #020617;
      padding: 2px 8px;
      font-size: 11px;
      color: var(--muted);
    }

    .file-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 220px;
      overflow: auto;
    }

    .file-item {
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: #020617;
      padding: 6px 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
    }

    .file-item-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .file-name {
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .file-status {
      font-size: 11px;
      color: var(--muted);
    }

    .file-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
      color: var(--muted);
    }

    .file-progress {
      height: 5px;
      border-radius: 999px;
      overflow: hidden;
      background: #111827;
    }

    .file-progress-bar {
      height: 100%;
      width: 0;
      background: linear-gradient(to right, #22c55e, #2dd4ff);
      transition: width 0.2s linear;
    }

    .two-col {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 8px;
    }

    .text-output {
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: #020617;
      padding: 8px;
      font-size: 12px;
      color: var(--muted);
      max-height: 260px;
      overflow: auto;
      white-space: pre-wrap;
    }

    .log-console {
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: #020617;
      padding: 8px;
      font-size: 11px;
      color: var(--muted);
      max-height: 220px;
      overflow: auto;
    }

    .log-line {
      margin-bottom: 3px;
      opacity: 0.8;
    }

    .log-line span {
      color: #64748b;
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 5px;
      font-size: 11px;
      max-height: 220px;
      overflow: auto;
    }

    .history-item {
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: #020617;
      padding: 5px 7px;
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }

    .history-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .history-type {
      font-weight: 500;
    }

    .history-meta {
      color: var(--muted);
    }

    .history-status {
      font-size: 11px;
    }

    .history-status.success {
      color: var(--success);
    }
    .history-status.error {
      color: var(--danger);
    }

    .badge {
      border-radius: 999px;
      padding: 1px 6px;
      font-size: 10px;
      background: #020617;
      border: 1px solid var(--border);
      color: var(--muted);
    }

    .select {
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: #020617;
      padding: 6px 8px;
      color: var(--text);
      font-size: 13px;
      outline: none;
    }

    .stack {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    @media (max-width: 900px) {
      .layout {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        border-inline-end: none;
        border-bottom: 1px solid var(--border);
        padding-bottom: 8px;
        overflow-x: auto;
      }

      .nav-list {
        flex-direction: row;
        overflow-x: auto;
      }

      .nav-item {
        flex: 0 0 auto;
        min-width: 140px;
      }

      .grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 640px) {
      .app-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .header-right {
        width: 100%;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body>
<div class="app">
  <header class="app-header">
    <div class="app-title">
      <div class="logo">P</div>
      <div>
        <div class="title-text-main" data-i18n="appTitle">PDF Master Tool</div>
        <div class="title-text-sub" data-i18n="appSubtitle">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„ÙƒÙ„ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù€ PDF</div>
      </div>
    </div>
    <div class="header-right">
      <div class="lang-toggle">
        <button class="lang-btn active" data-lang="ar">AR</button>
        <button class="lang-btn" data-lang="en">EN</button>
      </div>
      <div class="status-pill">
        <span class="status-dot" id="statusDot"></span>
        <span id="statusText">Checking...</span>
      </div>
    </div>
  </header>

  <div class="layout">
    <aside class="sidebar">
      <div class="sidebar-section-title" data-i18n="navMain">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div>
      <div class="nav-list">
        <div class="nav-item active" data-section="compress">
          <span>
            <span>ğŸ“¦</span>
            <span data-i18n="navCompress">Ø¶ØºØ· Ø§Ù„Ù…Ù„ÙØ§Øª</span>
          </span>
          <span class="nav-pill">Pro</span>
        </div>
        <div class="nav-item" data-section="merge">
          <span>
            <span>â•</span>
            <span data-i18n="navMerge">Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª</span>
          </span>
        </div>
        <div class="nav-item" data-section="split">
          <span>
            <span>âœ‚ï¸</span>
            <span data-i18n="navSplit">ØªÙ‚Ø³ÙŠÙ… / Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØµÙØ­Ø§Øª</span>
          </span>
        </div>
        <div class="nav-item" data-section="text">
          <span>
            <span>ğŸ“</span>
            <span data-i18n="navText">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ</span>
          </span>
        </div>
        <div class="nav-item" data-section="info">
          <span>
            <span>â„¹ï¸</span>
            <span data-i18n="navInfo">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù</span>
          </span>
        </div>
      </div>

      <div class="sidebar-section-title" data-i18n="navAdvanced">Ù…ØªÙ‚Ø¯Ù‘Ù…</div>
      <div class="nav-list">
        <div class="nav-item" data-section="protect">
          <span>
            <span>ğŸ”</span>
            <span data-i18n="navProtect">Ø­Ù…Ø§ÙŠØ© / ÙÙƒ Ø§Ù„Ø­Ù…Ø§ÙŠØ©</span>
          </span>
        </div>
        <div class="nav-item" data-section="watermark">
          <span>
            <span>ğŸ’§</span>
            <span data-i18n="navWatermark">Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©</span>
          </span>
        </div>
        <div class="nav-item" data-section="rotate">
          <span>
            <span>ğŸ”„</span>
            <span data-i18n="navRotate">ØªØ¯ÙˆÙŠØ± / Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨</span>
          </span>
        </div>
      </div>

      <div class="sidebar-section-title" data-i18n="navSystem">Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„Ù†Ø¸Ø§Ù…</div>
      <div class="nav-list">
        <div class="nav-item" data-section="supabase">
          <span>
            <span>ğŸ—‚ï¸</span>
            <span data-i18n="navSupabase">Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Supabase</span>
          </span>
        </div>
        <div class="nav-item" data-section="history">
          <span>
            <span>ğŸ“Š</span>
            <span data-i18n="navHistory">Ø§Ù„Ø³Ø¬Ù„ Ùˆ Ø§Ù„Ø­Ø§Ù„Ø©</span>
          </span>
        </div>
      </div>
    </aside>

    <main class="main">
      <section id="section-compress" class="section">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="compressTitle">Ø¶ØºØ· Ù…Ù„ÙØ§Øª PDF</div>
            <div class="section-subtitle" data-i18n="compressSubtitle">Ø±ÙØ¹ØŒ Ø¶ØºØ·ØŒ ÙˆØªÙ†Ø²ÙŠÙ„ Ù…Ù„ÙØ§Øª PDF Ø¨Ø£Ø¹Ù„Ù‰ ÙƒÙØ§Ø¡Ø©</div>
          </div>
          <div class="section-badge" data-i18n="sectionPowered">Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø³ÙŠØ±ÙØ± PDF PRO</div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="compressUploadTitle">Ø±ÙØ¹ ÙˆØ¶ØºØ· Ø¹Ø¯Ø© Ù…Ù„ÙØ§Øª</div>
                <div class="card-subtitle" data-i18n="compressUploadSubtitle">Ø±ÙØ¹ Ø¥Ù„Ù‰ Supabase Ø«Ù… Ø¶ØºØ· Ø¹Ø¨Ø± Ø§Ù„Ø³ÙŠØ±ÙØ±</div>
              </div>
            </div>
            <div class="card-body">
              <div id="compress-drop" class="file-drop">
                <div class="file-drop-title" data-i18n="compressDropTitle">Ø§Ø³Ø­Ø¨ Ù…Ù„ÙØ§Øª PDF Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</div>
                <div class="file-drop-sub" data-i18n="compressDropSub">ÙŠØ¯Ø¹Ù… Ø±ÙØ¹ Ø¹Ø¯Ø© Ù…Ù„ÙØ§Øª ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª</div>
              </div>
              <input type="file" id="compress-input" accept="application/pdf" multiple style="display:none">

              <div class="file-list" id="compress-file-list"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="compressUrlTitle">Ø¶ØºØ· Ù…Ù† Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø©</div>
                <div class="card-subtitle" data-i18n="compressUrlSubtitle">Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· PDF Ù…Ø¨Ø§Ø´Ø± ÙˆØ³ÙŠØªÙ… Ø¶ØºØ·Ù‡ ÙˆØªÙ†Ø²ÙŠÙ„Ù‡</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="input-group">
                <label class="input-label" data-i18n="compressUrlLabel">Ø±Ø§Ø¨Ø· Ù…Ù„Ù PDF</label>
                <input class="input" id="compress-url-input" placeholder="https://example.com/file.pdf">
              </div>
              <button class="btn" id="compress-url-btn">
                <span data-i18n="btnCompressUrl">Ø¶ØºØ· Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·</span>
              </button>
              <div class="chips">
                <div class="chip" data-i18n="hintSecure">Ù„Ø§ ÙŠØªÙ… ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ù„ÙØ§Øª Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="section-merge" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="mergeTitle">Ø¯Ù…Ø¬ Ù…Ù„ÙØ§Øª PDF</div>
            <div class="section-subtitle" data-i18n="mergeSubtitle">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ Ø£Ùˆ Ù…Ù† Supabase Ø«Ù… Ø¯Ù…Ø¬Ù‡Ø§ Ø¨ØªØ±ØªÙŠØ¨ Ù…Ø®ØµØµ</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="mergeLocalTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ù„ÙØ§Øª Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</div>
                <div class="card-subtitle" data-i18n="mergeLocalSubtitle">Ø§Ù„Ù…Ù„ÙØ§Øª Ø³ÙŠØªÙ… Ø±ÙØ¹Ù‡Ø§ Ø¥Ù„Ù‰ Supabase ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</div>
              </div>
            </div>
            <div class="card-body stack">
              <div id="merge-drop" class="file-drop">
                <div class="file-drop-title" data-i18n="mergeDropTitle">Ø§Ø³Ø­Ø¨ Ù…Ù„ÙØ§Øª PDF Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø¥Ø¶Ø§ÙØ©</div>
                <div class="file-drop-sub" data-i18n="mergeDropSub">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨Ù‡Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ù…Ø¬</div>
              </div>
              <input type="file" id="merge-input" accept="application/pdf" multiple style="display:none">
              <div class="file-list" id="merge-file-list"></div>
              <button class="btn" id="merge-btn">
                <span data-i18n="btnMerge">Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</span>
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="mergeSupabaseTitle">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Supabase</div>
                <div class="card-subtitle" data-i18n="mergeSupabaseSubtitle">Ø§Ø®ØªØ± Ù…Ù„ÙØ§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§ ÙÙŠ Ø§Ù„Ø¨Ø§ÙƒØª</div>
              </div>
              <button class="btn-secondary btn-sm" id="merge-refresh-supa">
                <span data-i18n="btnRefresh">ØªØ­Ø¯ÙŠØ«</span>
              </button>
            </div>
            <div class="card-body stack">
              <div class="file-list" id="merge-supabase-list"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="section-split" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="splitTitle">ØªÙ‚Ø³ÙŠÙ… / Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØµÙØ­Ø§Øª</div>
            <div class="section-subtitle" data-i18n="splitSubtitle">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="splitSourceTitle">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±</div>
                <div class="card-subtitle" data-i18n="splitSourceSubtitle">Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² (Ù…Ø±ÙÙˆØ¹ Ø¥Ù„Ù‰ Supabase) Ø£Ùˆ Ù…Ù† Supabase Ù…Ø¨Ø§Ø´Ø±Ø©</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="row">
                <button class="btn-secondary btn-sm" id="split-local-btn" data-i18n="btnChooseLocal">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
                <button class="btn-secondary btn-sm" id="split-supa-refresh" data-i18n="btnChooseSupabase">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase</button>
              </div>
              <input type="file" id="split-input" accept="application/pdf" style="display:none">
              <div class="file-list" id="split-supa-list"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="splitPagesTitle">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙØ­Ø§Øª</div>
                <div class="card-subtitle" data-i18n="splitPagesSubtitle">Ù…Ø«Ø§Ù„: 1-3,5,7-8</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="input-group">
                <label class="input-label" data-i18n="splitPagesLabel">Ù†Ø·Ø§Ù‚ Ø§Ù„ØµÙØ­Ø§Øª</label>
                <input class="input" id="split-pages-input" placeholder="1-3,5,7-8">
              </div>
              <button class="btn" id="split-extract-btn">
                <span data-i18n="btnExtractPages">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</span>
              </button>
            </div>
          </div>
        </div>
      </section>

      <section id="section-text" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="textTitle">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ</div>
            <div class="section-subtitle" data-i18n="textSubtitle">Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Øµ Ù…Ù† Ù…Ù„ÙØ§Øª PDF ÙˆØ¹Ø±Ø¶Ù‡ Ø£Ùˆ ØªØ­Ù…ÙŠÙ„Ù‡ ÙƒÙ…Ù„Ù Ù†ØµÙŠ</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="textSourceTitle">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="row">
                <button class="btn-secondary btn-sm" id="text-local-btn" data-i18n="btnChooseLocal">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
                <button class="btn-secondary btn-sm" id="text-supa-refresh" data-i18n="btnChooseSupabase">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase</button>
              </div>
              <input type="file" id="text-input" accept="application/pdf" style="display:none">
              <div class="file-list" id="text-supa-list"></div>
              <button class="btn" id="text-extract-btn">
                <span data-i18n="btnExtractText">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ</span>
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="textOutputTitle">Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬</div>
              </div>
              <div class="row">
                <button class="btn-secondary btn-sm" id="text-copy-btn" data-i18n="btnCopyText">Ù†Ø³Ø® Ø§Ù„Ù†Øµ</button>
                <button class="btn-secondary btn-sm" id="text-download-btn" data-i18n="btnDownloadText">ØªØ­Ù…ÙŠÙ„ ÙƒÙ…Ù„Ù TXT</button>
              </div>
            </div>
            <div class="card-body">
              <div class="text-output" id="text-output"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="section-info" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="infoTitle">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ù…Ù„Ù PDF</div>
            <div class="section-subtitle" data-i18n="infoSubtitle">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§ØªØŒ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„ÙØŒ ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="infoSourceTitle">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="row">
                <button class="btn-secondary btn-sm" id="info-local-btn" data-i18n="btnChooseLocal">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
                <button class="btn-secondary btn-sm" id="info-supa-refresh" data-i18n="btnChooseSupabase">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase</button>
              </div>
              <input type="file" id="info-input" accept="application/pdf" style="display:none">
              <div class="file-list" id="info-supa-list"></div>
              <button class="btn" id="info-fetch-btn">
                <span data-i18n="btnGetInfo">Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</span>
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="infoDetailsTitle">Ø§Ù„Ù†ØªÙŠØ¬Ø©</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="chips" id="info-result-chips"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="section-protect" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="protectTitle">Ø­Ù…Ø§ÙŠØ© / ÙÙƒ Ø§Ù„Ø­Ù…Ø§ÙŠØ©</div>
            <div class="section-subtitle" data-i18n="protectSubtitle">Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø© Ø­Ù…Ø§ÙŠØ© Ù…Ù†Ø·Ù‚ÙŠØ© Ø£Ùˆ Ø¥Ø²Ø§Ù„Ø© ØµÙØ­Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="protectAddTitle">Ø¥Ø¶Ø§ÙØ© Ø­Ù…Ø§ÙŠØ© (Ù…Ù†Ø·Ù‚ÙŠØ©)</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="row">
                <button class="btn-secondary btn-sm" id="protect-local-btn" data-i18n="btnChooseLocal">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
                <button class="btn-secondary btn-sm" id="protect-supa-refresh" data-i18n="btnChooseSupabase">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase</button>
              </div>
              <input type="file" id="protect-input" accept="application/pdf" style="display:none">
              <div class="file-list" id="protect-supa-list"></div>

              <div class="input-group">
                <label class="input-label" data-i18n="protectPasswordLabel">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input class="input" id="protect-password-input" type="text" placeholder="********">
              </div>
              <button class="btn" id="protect-btn">
                <span data-i18n="btnProtect">Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ù…Ø­Ù…ÙŠØ©</span>
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="unlockTitle">ÙÙƒ Ø§Ù„Ø­Ù…Ø§ÙŠØ©</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="row">
                <button class="btn-secondary btn-sm" id="unlock-local-btn" data-i18n="btnChooseLocal">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
                <button class="btn-secondary btn-sm" id="unlock-supa-refresh" data-i18n="btnChooseSupabase">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase</button>
              </div>
              <input type="file" id="unlock-input" accept="application/pdf" style="display:none">
              <div class="file-list" id="unlock-supa-list"></div>
              <button class="btn" id="unlock-btn">
                <span data-i18n="btnUnlock">Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø¨Ø¯ÙˆÙ† Ø­Ù…Ø§ÙŠØ©</span>
              </button>
            </div>
          </div>
        </div>
      </section>

      <section id="section-watermark" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="watermarkTitle">Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© (Ù†Øµ)</div>
            <div class="section-subtitle" data-i18n="watermarkSubtitle">Ø¥Ø¶Ø§ÙØ© Ù†Øµ Ù…Ø§Ø¦Ù„ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="watermarkSourceTitle">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="row">
                <button class="btn-secondary btn-sm" id="wm-local-btn" data-i18n="btnChooseLocal">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
                <button class="btn-secondary btn-sm" id="wm-supa-refresh" data-i18n="btnChooseSupabase">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase</button>
              </div>
              <input type="file" id="wm-input" accept="application/pdf" style="display:none">
              <div class="file-list" id="wm-supa-list"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="watermarkOptionsTitle">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="input-group">
                <label class="input-label" data-i18n="watermarkTextLabel">Ø§Ù„Ù†Øµ</label>
                <input class="input" id="wm-text-input" placeholder="CONFIDENTIAL / Ø³Ø±ÙŠ">
              </div>
              <div class="two-col">
                <div class="input-group">
                  <label class="input-label" data-i18n="watermarkColorLabel">Ø§Ù„Ù„ÙˆÙ†</label>
                  <select class="select" id="wm-color-select">
                    <option value="red">Red</option>
                    <option value="blue">Blue</option>
                    <option value="green">Green</option>
                    <option value="white">White</option>
                    <option value="black">Black</option>
                  </select>
                </div>
                <div class="input-group">
                  <label class="input-label" data-i18n="watermarkOpacityLabel">Ø§Ù„Ø´ÙØ§ÙÙŠØ©</label>
                  <input class="input" id="wm-opacity-input" type="number" min="0.1" max="1" step="0.1" value="0.2">
                </div>
              </div>
              <button class="btn" id="wm-apply-btn">
                <span data-i18n="btnApplyWatermark">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©</span>
              </button>
            </div>
          </div>
        </div>
      </section>

      <section id="section-rotate" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="rotateTitle">ØªØ¯ÙˆÙŠØ± / Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙØ­Ø§Øª</div>
            <div class="section-subtitle" data-i18n="rotateSubtitle">ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ ÙÙŠ ØªØ±ØªÙŠØ¨ ÙˆØ§ØªØ¬Ø§Ù‡ Ø§Ù„ØµÙØ­Ø§Øª</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="rotateSourceTitle">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="row">
                <button class="btn-secondary btn-sm" id="rot-local-btn" data-i18n="btnChooseLocal">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
                <button class="btn-secondary btn-sm" id="rot-supa-refresh" data-i18n="btnChooseSupabase">ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase</button>
              </div>
              <input type="file" id="rot-input" accept="application/pdf" style="display:none">
              <div class="file-list" id="rot-supa-list"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="rotateOptsTitle">Ø§Ù„ØªØ¯ÙˆÙŠØ± ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="two-col">
                <div class="input-group">
                  <label class="input-label" data-i18n="rotateAngleLabel">Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØªØ¯ÙˆÙŠØ±</label>
                  <select class="select" id="rot-angle-select">
                    <option value="90">90Â°</option>
                    <option value="180">180Â°</option>
                    <option value="270">270Â°</option>
                  </select>
                </div>
                <div class="input-group">
                  <label class="input-label" data-i18n="rotatePagesLabel">Ø§Ù„ØµÙØ­Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                  <input class="input" id="rot-pages-input" placeholder="all Ø£Ùˆ 1-3,5">
                </div>
              </div>
              <button class="btn" id="rot-apply-btn">
                <span data-i18n="btnApplyRotate">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¯ÙˆÙŠØ±</span>
              </button>

              <div class="input-group">
                <label class="input-label" data-i18n="reorderLabel">ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙØ­Ø§Øª (Ù…Ø«Ø§Ù„: 3,1,2)</label>
                <input class="input" id="reorder-input" placeholder="3,1,2">
              </div>
              <button class="btn-secondary" id="reorder-apply-btn">
                <span data-i18n="btnApplyReorder">ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨</span>
              </button>
            </div>
          </div>
        </div>
      </section>

      <section id="section-supabase" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="supaTitle">Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Supabase</div>
            <div class="section-subtitle" data-i18n="supaSubtitle">Ø§Ø³ØªØ¹Ø±Ø§Ø¶ØŒ Ø¶ØºØ·ØŒ Ø­Ø°ÙØŒ ÙˆÙ†Ø³Ø® Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="supaUploadTitle">Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Supabase</div>
              </div>
            </div>
            <div class="card-body stack">
              <div class="file-drop" id="supa-upload-drop">
                <div class="file-drop-title" data-i18n="supaDropTitle">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</div>
                <div class="file-drop-sub" data-i18n="supaDropSub">ÙŠØªÙ… Ø±ÙØ¹Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø§ÙƒØª pdf-files</div>
              </div>
              <input type="file" id="supa-upload-input" accept="application/pdf" multiple style="display:none">
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="supaListTitle">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª</div>
              </div>
              <button class="btn-secondary btn-sm" id="supa-refresh-btn">
                <span data-i18n="btnRefresh">ØªØ­Ø¯ÙŠØ«</span>
              </button>
            </div>
            <div class="card-body">
              <div class="file-list" id="supa-list-container"></div>
            </div>
          </div>
        </div>
      </section>

      <section id="section-history" class="section" style="display:none">
        <div class="section-header">
          <div>
            <div class="section-title" data-i18n="historyTitle">Ø§Ù„Ø³Ø¬Ù„ Ùˆ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±</div>
            <div class="section-subtitle" data-i18n="historySubtitle">Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ù…Ù„ÙŠØ§ØªÙƒ ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ±ÙØ± ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ</div>
          </div>
        </div>
        <div class="grid">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="historyOpsTitle">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
              </div>
              <button class="btn-secondary btn-sm" id="history-clear-btn" data-i18n="btnClearHistory">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
            </div>
            <div class="card-body">
              <div class="history-list" id="history-list"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title" data-i18n="logsTitle">Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</div>
              </div>
              <button class="btn-secondary btn-sm" id="logs-clear-btn" data-i18n="btnClearLogs">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
            </div>
            <div class="card-body">
              <div class="log-console" id="logs-console"></div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>

<script type="module">
  const SERVER_BASE = "https://pdf-server-navy.vercel.app";
  const SUPABASE_URL = "https://tdqewqarcvdunwuxgios.supabase.co";
  // **Ù…Ù„Ø§Ø­Ø¸Ø©:** ÙŠÙØ¶Ù„ Ø¥Ø®ÙØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙØªØ§Ø­ ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ÙØ¹Ù„ÙŠ ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙØªØ§Ø­ Ø®Ø¯Ù…Ø©.
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRkcWV3cWFyY3ZkdW53dXhnaW9zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0ODc4NDcsImV4cCI6MjA4MTA2Mzg0N30.RSMghTLwda7kLidTohBFLqE7qCQoHs3S6l88ewUidRw";
  const BUCKET_NAME = "pdf-files";

  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
  const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

  const i18n = {
    ar: {
      appTitle: "PDF Master Tool",
      appSubtitle: "Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„ÙƒÙ„ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù€ PDF",
      navMain: "Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©",
      navCompress: "Ø¶ØºØ· Ø§Ù„Ù…Ù„ÙØ§Øª",
      navMerge: "Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª",
      navSplit: "ØªÙ‚Ø³ÙŠÙ… / Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØµÙØ­Ø§Øª",
      navText: "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ",
      navInfo: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù„Ù",
      navAdvanced: "Ù…ØªÙ‚Ø¯Ù‘Ù…",
      navProtect: "Ø­Ù…Ø§ÙŠØ© / ÙÙƒ Ø§Ù„Ø­Ù…Ø§ÙŠØ©",
      navWatermark: "Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©",
      navRotate: "ØªØ¯ÙˆÙŠØ± / Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨",
      navSystem: "Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„Ù†Ø¸Ø§Ù…",
      navSupabase: "Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Supabase",
      navHistory: "Ø§Ù„Ø³Ø¬Ù„ Ùˆ Ø§Ù„Ø­Ø§Ù„Ø©",
      compressTitle: "Ø¶ØºØ· Ù…Ù„ÙØ§Øª PDF",
      compressSubtitle: "Ø±ÙØ¹ØŒ Ø¶ØºØ·ØŒ ÙˆØªÙ†Ø²ÙŠÙ„ Ù…Ù„ÙØ§Øª PDF Ø¨Ø£Ø¹Ù„Ù‰ ÙƒÙØ§Ø¡Ø©",
      sectionPowered: "Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø³ÙŠØ±ÙØ± PDF PRO",
      compressUploadTitle: "Ø±ÙØ¹ ÙˆØ¶ØºØ· Ø¹Ø¯Ø© Ù…Ù„ÙØ§Øª",
      compressUploadSubtitle: "Ø±ÙØ¹ Ø¥Ù„Ù‰ Supabase Ø«Ù… Ø¶ØºØ· Ø¹Ø¨Ø± Ø§Ù„Ø³ÙŠØ±ÙØ±",
      compressDropTitle: "Ø§Ø³Ø­Ø¨ Ù…Ù„ÙØ§Øª PDF Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±",
      compressDropSub: "ÙŠØ¯Ø¹Ù… Ø±ÙØ¹ Ø¹Ø¯Ø© Ù…Ù„ÙØ§Øª ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª",
      compressUrlTitle: "Ø¶ØºØ· Ù…Ù† Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø©",
      compressUrlSubtitle: "Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· PDF Ù…Ø¨Ø§Ø´Ø± ÙˆØ³ÙŠØªÙ… Ø¶ØºØ·Ù‡ ÙˆØªÙ†Ø²ÙŠÙ„Ù‡",
      compressUrlLabel: "Ø±Ø§Ø¨Ø· Ù…Ù„Ù PDF",
      btnCompressUrl: "Ø¶ØºØ· Ø§Ù„Ù…Ù„Ù Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·",
      hintSecure: "Ù„Ø§ ÙŠØªÙ… ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ù„ÙØ§Øª Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±",
      mergeTitle: "Ø¯Ù…Ø¬ Ù…Ù„ÙØ§Øª PDF",
      mergeSubtitle: "Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ Ø£Ùˆ Ù…Ù† Supabase Ø«Ù… Ø¯Ù…Ø¬Ù‡Ø§ Ø¨ØªØ±ØªÙŠØ¨ Ù…Ø®ØµØµ",
      mergeLocalTitle: "Ø¥Ø¶Ø§ÙØ© Ù…Ù„ÙØ§Øª Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²",
      mergeLocalSubtitle: "Ø§Ù„Ù…Ù„ÙØ§Øª Ø³ÙŠØªÙ… Ø±ÙØ¹Ù‡Ø§ Ø¥Ù„Ù‰ Supabase ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§",
      mergeDropTitle: "Ø§Ø³Ø­Ø¨ Ù…Ù„ÙØ§Øª PDF Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø¥Ø¶Ø§ÙØ©",
      mergeDropSub: "ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨Ù‡Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ù…Ø¬",
      mergeSupabaseTitle: "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Supabase",
      mergeSupabaseSubtitle: "Ø§Ø®ØªØ± Ù…Ù„ÙØ§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ù‹Ø§ ÙÙŠ Ø§Ù„Ø¨Ø§ÙƒØª",
      btnMerge: "Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",
      btnRefresh: "ØªØ­Ø¯ÙŠØ«",
      splitTitle: "ØªÙ‚Ø³ÙŠÙ… / Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØµÙØ­Ø§Øª",
      splitSubtitle: "Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©",
      splitSourceTitle: "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±",
      splitSourceSubtitle: "Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² (Ù…Ø±ÙÙˆØ¹ Ø¥Ù„Ù‰ Supabase) Ø£Ùˆ Ù…Ù† Supabase Ù…Ø¨Ø§Ø´Ø±Ø©",
      btnChooseLocal: "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²",
      btnChooseSupabase: "ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Supabase",
      splitPagesTitle: "ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙØ­Ø§Øª",
      splitPagesSubtitle: "Ù…Ø«Ø§Ù„: 1-3,5,7-8",
      splitPagesLabel: "Ù†Ø·Ø§Ù‚ Ø§Ù„ØµÙØ­Ø§Øª",
      btnExtractPages: "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©",
      textTitle: "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ",
      textSubtitle: "Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Øµ Ù…Ù† Ù…Ù„ÙØ§Øª PDF ÙˆØ¹Ø±Ø¶Ù‡ Ø£Ùˆ ØªØ­Ù…ÙŠÙ„Ù‡ ÙƒÙ…Ù„Ù Ù†ØµÙŠ",
      textSourceTitle: "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±",
      btnExtractText: "Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ",
      textOutputTitle: "Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬",
      btnCopyText: "Ù†Ø³Ø® Ø§Ù„Ù†Øµ",
      btnDownloadText: "ØªØ­Ù…ÙŠÙ„ ÙƒÙ…Ù„Ù TXT",
      infoTitle: "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ù…Ù„Ù PDF",
      infoSubtitle: "Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§ØªØŒ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„ÙØŒ ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ©",
      infoSourceTitle: "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±",
      btnGetInfo: "Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",
      infoDetailsTitle: "Ø§Ù„Ù†ØªÙŠØ¬Ø©",
      protectTitle: "Ø­Ù…Ø§ÙŠØ© / ÙÙƒ Ø§Ù„Ø­Ù…Ø§ÙŠØ©",
      protectSubtitle: "Ø¥Ø¶Ø§ÙØ© Ø·Ø¨Ù‚Ø© Ø­Ù…Ø§ÙŠØ© Ù…Ù†Ø·Ù‚ÙŠØ© Ø£Ùˆ Ø¥Ø²Ø§Ù„Ø© ØµÙØ­Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡",
      protectAddTitle: "Ø¥Ø¶Ø§ÙØ© Ø­Ù…Ø§ÙŠØ© (Ù…Ù†Ø·Ù‚ÙŠØ©)",
      protectPasswordLabel: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
      btnProtect: "Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ù…Ø­Ù…ÙŠØ©",
      unlockTitle: "ÙÙƒ Ø§Ù„Ø­Ù…Ø§ÙŠØ©",
      btnUnlock: "Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø¨Ø¯ÙˆÙ† Ø­Ù…Ø§ÙŠØ©",
      watermarkTitle: "Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ© (Ù†Øµ)",
      watermarkSubtitle: "Ø¥Ø¶Ø§ÙØ© Ù†Øµ Ù…Ø§Ø¦Ù„ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª",
      watermarkSourceTitle: "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±",
      watermarkOptionsTitle: "Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©",
      watermarkTextLabel: "Ø§Ù„Ù†Øµ",
      watermarkColorLabel: "Ø§Ù„Ù„ÙˆÙ†",
      watermarkOpacityLabel: "Ø§Ù„Ø´ÙØ§ÙÙŠØ©",
      btnApplyWatermark: "ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©",
      rotateTitle: "ØªØ¯ÙˆÙŠØ± / Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙØ­Ø§Øª",
      rotateSubtitle: "ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ ÙÙŠ ØªØ±ØªÙŠØ¨ ÙˆØ§ØªØ¬Ø§Ù‡ Ø§Ù„ØµÙØ­Ø§Øª",
      rotateSourceTitle: "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ù…ØµØ¯Ø±",
      rotateOptsTitle: "Ø§Ù„ØªØ¯ÙˆÙŠØ± ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨",
      rotateAngleLabel: "Ø²Ø§ÙˆÙŠØ© Ø§Ù„ØªØ¯ÙˆÙŠØ±",
      rotatePagesLabel: "Ø§Ù„ØµÙØ­Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
      btnApplyRotate: "ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¯ÙˆÙŠØ±",
      reorderLabel: "ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙØ­Ø§Øª (Ù…Ø«Ø§Ù„: 3,1,2)",
      btnApplyReorder: "ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨",
      supaTitle: "Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Supabase",
      supaSubtitle: "Ø§Ø³ØªØ¹Ø±Ø§Ø¶ØŒ Ø¶ØºØ·ØŒ Ø­Ø°ÙØŒ ÙˆÙ†Ø³Ø® Ø§Ù„Ø±ÙˆØ§Ø¨Ø·",
      supaUploadTitle: "Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Supabase",
      supaDropTitle: "Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±",
      supaDropSub: "ÙŠØªÙ… Ø±ÙØ¹Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø§ÙƒØª pdf-files",
      supaListTitle: "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª",
      historyTitle: "Ø§Ù„Ø³Ø¬Ù„ Ùˆ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ±ÙØ±",
      historySubtitle: "Ù…ØªØ§Ø¨Ø¹Ø© Ø¹Ù…Ù„ÙŠØ§ØªÙƒ ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ±ÙØ± ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ",
      historyOpsTitle: "Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª",
      btnClearHistory: "Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„",
      logsTitle: "Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«",
      btnClearLogs: "Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„",
    },
    en: {
      appTitle: "PDF Master Tool",
      appSubtitle: "A professional dashboard for all PDF tools",
      navMain: "Core operations",
      navCompress: "Compress",
      navMerge: "Merge",
      navSplit: "Split / Extract Pages",
      navText: "Extract Text",
      navInfo: "PDF Info",
      navAdvanced: "Advanced",
      navProtect: "Protect / Unlock",
      navWatermark: "Watermark",
      navRotate: "Rotate / Reorder",
      navSystem: "Files & System",
      navSupabase: "Supabase Files",
      navHistory: "History & Status",
      compressTitle: "Compress PDF files",
      compressSubtitle: "Upload, compress, and download PDFs efficiently",
      sectionPowered: "Powered by PDF PRO server",
      compressUploadTitle: "Upload & compress multiple files",
      compressUploadSubtitle: "Upload to Supabase then compress via server",
      compressDropTitle: "Drop PDF files here or click to select",
      compressDropSub: "Supports multiple files at once",
      compressUrlTitle: "Compress from direct URL",
      compressUrlSubtitle: "Paste a direct PDF URL and compress it",
      compressUrlLabel: "PDF URL",
      btnCompressUrl: "Compress PDF from URL",
      hintSecure: "Files are not permanently stored on the server",
      mergeTitle: "Merge PDF files",
      mergeSubtitle: "Choose files from device or Supabase and merge in custom order",
      mergeLocalTitle: "Add files from device",
      mergeLocalSubtitle: "Files will be uploaded to Supabase automatically",
      mergeDropTitle: "Drop PDF files or click to add",
      mergeDropSub: "You can reorder them before merging",
      mergeSupabaseTitle: "Pick from Supabase",
      mergeSupabaseSubtitle: "Use files already in the bucket",
      btnMerge: "Merge selected files",
      btnRefresh: "Refresh",
      splitTitle: "Split / Extract pages",
      splitSubtitle: "Create a new PDF with the pages you want",
      splitSourceTitle: "Choose source file",
      splitSourceSubtitle: "From your device or directly from Supabase",
      btnChooseLocal: "Choose from device",
      btnChooseSupabase: "Refresh Supabase list",
      splitPagesTitle: "Choose pages",
      splitPagesSubtitle: "Example: 1-3,5,7-8",
      splitPagesLabel: "Pages range",
      btnExtractPages: "Extract pages",
      textTitle: "Extract text",
      textSubtitle: "Read text from PDF and preview or download it",
      textSourceTitle: "Choose source file",
      btnExtractText: "Extract text",
      textOutputTitle: "Extracted text",
      btnCopyText: "Copy text",
      btnDownloadText: "Download as TXT",
      infoTitle: "PDF info",
      infoSubtitle: "Pages count, size, and basic info",
      infoSourceTitle: "Choose source file",
      btnGetInfo: "Get info",
      infoDetailsTitle: "Result",
      protectTitle: "Protect / Unlock",
      protectSubtitle: "Add a logical protection layer or remove it",
      protectAddTitle: "Add protection (logical)",
      protectPasswordLabel: "Password",
      btnProtect: "Create protected copy",
      unlockTitle: "Unlock",
      btnUnlock: "Create unlocked copy",
      watermarkTitle: "Watermark (text)",
      watermarkSubtitle: "Add slanted text on all pages",
      watermarkSourceTitle: "Choose source file",
      watermarkOptionsTitle: "Watermark options",
      watermarkTextLabel: "Text",
      watermarkColorLabel: "Color",
      watermarkOpacityLabel: "Opacity",
      btnApplyWatermark: "Apply watermark",
      rotateTitle: "Rotate / Reorder pages",
      rotateSubtitle: "Full control over pages orientation and order",
      rotateSourceTitle: "Choose source file",
      rotateOptsTitle: "Rotate & reorder",
      rotateAngleLabel: "Rotation angle",
      rotatePagesLabel: "Pages (optional)",
      btnApplyRotate: "Apply rotation",
      reorderLabel: "Pages order (example: 3,1,2)",
      btnApplyReorder: "Apply reorder",
      supaTitle: "Supabase files manager",
      supaSubtitle: "Browse, compress, delete, and copy URLs",
      supaUploadTitle: "Upload files to Supabase",
      supaDropTitle: "Drop files here or click to select",
      supaDropSub: "Uploaded directly into pdf-files bucket",
      supaListTitle: "Files list",
      historyTitle: "History & server status",
      historySubtitle: "Track your operations and server health in real-time",
      historyOpsTitle: "Operations history",
      btnClearHistory: "Clear history",
      logsTitle: "Events log",
      btnClearLogs: "Clear log",
    }
  };

  let currentLang = "ar";
  const statusDot = document.getElementById("statusDot");
  const statusText = document.getElementById("statusText");
  const historyList = document.getElementById("history-list");
  const logsConsole = document.getElementById("logs-console");

  function logMessage(message, type = "info") {
    const line = document.createElement("div");
    line.className = "log-line";
    const time = new Date().toLocaleTimeString();
    line.innerHTML = `<span>[${time}]</span> ${message}`;
    logsConsole.prepend(line);
    while (logsConsole.children.length > 50) { // Limit logs
        logsConsole.removeChild(logsConsole.lastChild);
    }
  }
  
  document.getElementById("logs-clear-btn").addEventListener("click", () => {
    logsConsole.innerHTML = "";
    logMessage("Logs cleared.");
  });
  
  document.getElementById("history-clear-btn").addEventListener("click", () => {
    historyList.innerHTML = "";
    logMessage("History cleared.");
  });

  function addHistoryEntry(type, fileName, success = true) {
    const entry = document.createElement("div");
    entry.className = "history-item";
    const main = document.createElement("div");
    main.className = "history-main";
    const t = document.createElement("div");
    t.className = "history-type";
    t.textContent = type;
    const meta = document.createElement("div");
    meta.className = "history-meta";
    meta.textContent = fileName;
    main.appendChild(t);
    main.appendChild(meta);
    const status = document.createElement("div");
    status.className = "history-status " + (success ? "success" : "error");
    status.textContent = success ? "OK" : "ERR";
    entry.appendChild(main);
    entry.appendChild(status);
    historyList.prepend(entry);
    while (historyList.children.length > 30) {
      historyList.removeChild(historyList.lastChild);
    }
  }

  async function checkHealth() {
    try {
      const res = await fetch(`${SERVER_BASE}/health`);
      if (!res.ok) throw new Error("Health failed");
      const data = await res.json();
      statusDot.classList.add("online");
      statusText.textContent = data.message || "Online";
      logMessage("Server online", "info");
    } catch (e) {
      statusDot.classList.remove("online");
      statusText.textContent = currentLang === "ar" ? "ØºÙŠØ± Ù…ØªØµÙ„" : "Offline";
      logMessage("Server offline", "error");
    }
  }

  checkHealth();
  setInterval(checkHealth, 45000);

  function switchLanguage(lang) {
    currentLang = lang;
    document.querySelectorAll(".lang-btn").forEach(btn => {
      btn.classList.toggle("active", btn.dataset.lang === lang);
    });
    const dict = i18n[lang];
    document.querySelectorAll("[data-i18n]").forEach(el => {
      const key = el.getAttribute("data-i18n");
      if (dict[key]) el.textContent = dict[key];
    });
    document.body.dir = lang === "ar" ? "rtl" : "ltr";
  }

  document.querySelectorAll(".lang-btn").forEach(btn => {
    btn.addEventListener("click", () => switchLanguage(btn.dataset.lang));
  });

  switchLanguage("ar");

  document.querySelectorAll(".nav-item").forEach(item => {
    item.addEventListener("click", () => {
      const section = item.dataset.section;
      document.querySelectorAll(".nav-item").forEach(i => i.classList.remove("active"));
      item.classList.add("active");
      
      document.querySelectorAll("main .section").forEach(sec => {
        sec.style.display = sec.id === `section-${section}` ? "block" : "none";
      });
      // ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Supabase Ø¹Ù†Ø¯ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ø£ÙŠ Ù‚Ø³Ù… ÙŠØ³ØªØ®Ø¯Ù…Ù‡Ø§ (Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«)
      if (section === 'merge' || section === 'split' || section === 'text' || section === 'info' || section === 'protect' || section === 'unlock' || section === 'watermark' || section === 'rotate' || section === 'supabase') {
          // ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù‚Ø³Ù…
      }
    });
  });

  async function uploadToSupabase(file) {
    const fileName = `${Date.now()}-${file.name}`;
    logMessage(`Upload start: ${file.name}`);
    
    // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø±ÙØ¹ ÙŠØªÙ… Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„ØµØ­ÙŠØ­ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ø§ÙƒØª
    const { data, error } = await supabase.storage.from(BUCKET_NAME).upload(fileName, file);
    if (error) {
      logMessage(`Upload failed: ${file.name} - ${error.message}`, "error");
      throw error;
    }
    const { data: pub } = supabase.storage.from(BUCKET_NAME).getPublicUrl(fileName);
    const publicUrl = pub.publicUrl;
    logMessage(`Upload done: ${file.name}`);
    return { fileName, publicUrl };
  }

  async function callBackendPdf(route, payload, downloadName) {
    const res = await fetch(`${SERVER_BASE}/${route}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    if (!res.ok) {
      const txt = await res.text();
      throw new Error(txt || `HTTP ${res.status}`);
    }
    const blob = await res.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = downloadName;
    a.click();
    URL.revokeObjectURL(url);
  }

  async function callBackendJson(route, payload) {
    const res = await fetch(`${SERVER_BASE}/${route}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    if (!res.ok) {
      const txt = await res.text();
      throw new Error(txt || `HTTP ${res.status}`);
    }
    return res.json();
  }

  function wireFileDrop(dropEl, inputEl, onFiles) {
    dropEl.addEventListener("click", () => inputEl.click());
    dropEl.addEventListener("dragover", e => {
      e.preventDefault();
      dropEl.classList.add("dragover");
    });
    dropEl.addEventListener("dragleave", () => dropEl.classList.remove("dragover"));
    dropEl.addEventListener("drop", e => {
      e.preventDefault();
      dropEl.classList.remove("dragover");
      if (e.dataTransfer.files && e.dataTransfer.files.length) {
        onFiles(e.dataTransfer.files);
      }
    });
    inputEl.addEventListener("change", e => {
      if (e.target.files && e.target.files.length) {
        onFiles(e.target.files);
      }
    });
  }
  
  // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù…ÙˆØ­Ø¯Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ù‚Ø§Ø¦Ù…Ø© Ù…Ù„ÙØ§Øª Supabase (Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±)
  function createSupaListItem(file, publicUrl, onSelect) {
      const el = document.createElement("div");
      el.className = "file-item";
      el.innerHTML = `
        <div class="file-item-header">
          <div class="file-name">${file.name}</div>
          <div class="row">
            <button class="btn-secondary btn-sm" data-act="select">${currentLang === "ar" ? "Ø§Ø®ØªÙŠØ§Ø±" : "Select"}</button>
          </div>
        </div>
        <div class="file-meta">
          <span>${publicUrl.slice(0, 40)}...</span>
        </div>
      `;
      el.querySelector("button").addEventListener("click", () => {
        onSelect({ fileName: file.name, publicUrl });
      });
      return el;
  }
  
  // Ø¯Ø§Ù„Ø© Ù…ÙˆØ­Ø¯Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ù…Ù„ÙØ§Øª Supabase
  async function loadSupabaseList(targetEl, onAction) {
    targetEl.innerHTML = currentLang === "ar" ? "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..." : "Loading...";
    const { data, error } = await supabase.storage.from(BUCKET_NAME).list();
    
    targetEl.innerHTML = "";
    if (error) {
      targetEl.textContent = error.message;
      return;
    }
    
    // ØªØµÙÙŠØ© ÙˆØ­Ø°Ù Ù…Ù„ÙØ§Øª .emptyFolderPlaceholder
    const pdfFiles = data.filter(file => file.name !== ".emptyFolderPlaceholder");
    
    pdfFiles.forEach(file => {
      const { data: pub } = supabase.storage.from(BUCKET_NAME).getPublicUrl(file.name);
      const publicUrl = pub.publicUrl;
      
      const el = createSupaListItem(file, publicUrl, onAction);
      targetEl.appendChild(el);
    });
    
    if (pdfFiles.length === 0) {
        targetEl.textContent = currentLang === "ar" ? "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª PDF ÙÙŠ Supabase" : "No PDF files found in Supabase";
    }
  }


  // ===============================
  // âœ… Compress Section
  // ===============================

  const compressDrop = document.getElementById("compress-drop");
  const compressInput = document.getElementById("compress-input");
  const compressList = document.getElementById("compress-file-list");

  wireFileDrop(compressDrop, compressInput, handleCompressFiles);

  function createCompressItem(file) {
    const el = document.createElement("div");
    el.className = "file-item";
    el.innerHTML = `
      <div class="file-item-header">
        <div class="file-name">${file.name}</div>
        <div class="file-status"></div>
      </div>
      <div class="file-meta">
        <span>${(file.size / (1024 * 1024)).toFixed(2)} MB</span>
      </div>
      <div class="file-progress">
        <div class="file-progress-bar"></div>
      </div>
    `;
    return el;
  }

  async function handleCompressFiles(files) {
    for (const file of files) {
      const itemEl = createCompressItem(file);
      compressList.appendChild(itemEl);
      const statusEl = itemEl.querySelector(".file-status");
      const bar = itemEl.querySelector(".file-progress-bar");

      try {
        statusEl.textContent = currentLang === "ar" ? "Ø±ÙØ¹ Ø¥Ù„Ù‰ Supabase..." : "Uploading to Supabase...";
        bar.style.width = "20%";
        const { publicUrl } = await uploadToSupabase(file);

        statusEl.textContent = currentLang === "ar" ? "Ø¶ØºØ· Ø¹Ø¨Ø± Ø§Ù„Ø³ÙŠØ±ÙØ±..." : "Compressing via server...";
        bar.style.width = "60%";
        await callBackendPdf("compress", { publicUrl }, "compressed-" + file.name);

        statusEl.textContent = currentLang === "ar" ? "ØªÙ… Ø§Ù„ØªÙ†Ø²ÙŠÙ„" : "Downloaded";
        bar.style.width = "100%";
        addHistoryEntry("Compress", file.name, true);
        logMessage(`Compressed: ${file.name}`);
      } catch (e) {
        statusEl.textContent = (currentLang === "ar" ? "Ø®Ø·Ø£: " : "Error: ") + e.message;
        bar.style.width = "100%";
        bar.style.background = "linear-gradient(to right, #f97373,#fb7185)";
        addHistoryEntry("Compress", file.name, false);
        logMessage(`Compress failed: ${file.name} - ${e.message}`, "error");
      }
    }
  }

  const compressUrlInput = document.getElementById("compress-url-input");
  const compressUrlBtn = document.getElementById("compress-url-btn");

  compressUrlBtn.addEventListener("click", async () => {
    const url = compressUrlInput.value.trim();
    if (!url) return;
    logMessage(`Compress from URL: ${url}`);
    try {
      await callBackendPdf("compress", { publicUrl: url }, "compressed-from-url.pdf");
      addHistoryEntry("Compress/URL", url.slice(0, 30) + '...', true);
      logMessage("Compression from URL successful.");
    } catch (e) {
      addHistoryEntry("Compress/URL", url.slice(0, 30) + '...', false);
      logMessage(`Compress from URL failed: ${e.message}`, "error");
      alert(e.message);
    }
  });


  // ===============================
  // âœ… Merge Section
  // ===============================

  const mergeDrop = document.getElementById("merge-drop");
  const mergeInput = document.getElementById("merge-input");
  const mergeFileList = document.getElementById("merge-file-list");
  const mergeSupaList = document.getElementById("merge-supabase-list");
  const mergeBtn = document.getElementById("merge-btn");
  const mergeRefreshSupa = document.getElementById("merge-refresh-supa");

  const mergeSources = [];

  wireFileDrop(mergeDrop, mergeInput, files => {
    for (const file of files) {
      const item = {
        type: "local",
        file,
        uploaded: false,
        publicUrl: null
      };
      mergeSources.push(item);
    }
    renderMergeList();
  });

  function renderMergeList() {
    mergeFileList.innerHTML = "";
    mergeSources.forEach((src, index) => {
      const el = document.createElement("div");
      el.className = "file-item";
      const fileName = src.type === "local" ? src.file.name : src.fileName;
      const fileSize = src.type === "local" ? (src.file.size / (1024 * 1024)).toFixed(2) + " MB" : "";
      
      el.innerHTML = `
        <div class="file-item-header">
          <div class="file-name">${fileName}</div>
          <div class="row">
            <button class="btn-secondary btn-sm" data-action="up" title="${currentLang === 'ar' ? 'Ø£Ø¹Ù„Ù‰' : 'Up'}">\u2191</button>
            <button class="btn-secondary btn-sm" data-action="down" title="${currentLang === 'ar' ? 'Ø£Ø³ÙÙ„' : 'Down'}">\u2193</button>
            <button class="btn-danger btn-sm" data-action="remove" title="${currentLang === 'ar' ? 'Ø¥Ø²Ø§Ù„Ø©' : 'Remove'}">\u00d7</button>
          </div>
        </div>
        <div class="file-meta">
          <span>${src.type}</span>
          <span>${fileSize}</span>
        </div>
      `;
      el.querySelectorAll("button").forEach(btn => {
        btn.addEventListener("click", () => {
          const action = btn.dataset.action;
          if (action === "remove") {
            mergeSources.splice(index, 1);
          } else if (action === "up" && index > 0) {
            const tmp = mergeSources[index - 1];
            mergeSources[index - 1] = mergeSources[index];
            mergeSources[index] = tmp;
          } else if (action === "down" && index < mergeSources.length - 1) {
            const tmp = mergeSources[index + 1];
            mergeSources[index + 1] = mergeSources[index];
            mergeSources[index] = tmp;
          }
          renderMergeList();
        });
      });
      mergeFileList.appendChild(el);
    });
  }

  mergeRefreshSupa.addEventListener("click", () => {
    loadSupabaseList(mergeSupaList, ({ fileName, publicUrl }) => {
      mergeSources.push({ type: "supabase", fileName, publicUrl });
      renderMergeList();
      mergeSupaList.innerHTML = currentLang === 'ar' ? "ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ù Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©" : "File added to list";
    });
  });

  mergeBtn.addEventListener("click", async () => {
    if (mergeSources.length < 2) {
      alert(currentLang === "ar" ? "Ø§Ø®ØªØ± Ù…Ù„ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„" : "Select at least two files");
      return;
    }
    try {
      const urls = [];
      for (const src of mergeSources) {
        if (src.type === "local" && !src.publicUrl) {
          logMessage(`Uploading ${src.file.name} for merge...`);
          const { publicUrl } = await uploadToSupabase(src.file);
          src.publicUrl = publicUrl;
        }
        urls.push(src.publicUrl);
      }
      logMessage(`Calling merge endpoint for ${urls.length} files...`);
      await callBackendPdf("merge", { publicUrls: urls }, "merged.pdf");
      addHistoryEntry("Merge", urls.length + " files", true);
      logMessage("Merge successful.");
    } catch (e) {
      addHistoryEntry("Merge", "error", false);
      logMessage("Merge failed: " + e.message, "error");
      alert(e.message);
    }
  });


  // ===============================
  // âœ… File Selection Logic (Source Files)
  // ===============================

  // Ø¯Ø§Ù„Ø© Ù…ÙˆØ­Ø¯Ø© Ù„Ø±Ø¨Ø· Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙˆÙ‚ÙˆØ§Ø¦Ù… Supabase
  function wireSourceSelection(localBtn, inputEl, supaRefreshBtn, supaListEl, operationName) {
      let publicUrl = null;
      let name = null;
      
      function renderSourceFile() {
          supaListEl.innerHTML = "";
          if (name && publicUrl) {
              const el = document.createElement("div");
              el.className = "file-item";
              el.innerHTML = `<div class="file-item-header"><div class="file-name">${name}</div></div>`;
              supaListEl.appendChild(el);
          } else {
              supaListEl.textContent = currentLang === 'ar' ? 'Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù' : 'No file selected';
          }
      }
      
      localBtn.addEventListener("click", () => inputEl.click());
      inputEl.addEventListener("change", async e => {
          const f = e.target.files[0];
          if (!f) return;
          try {
              const { publicUrl: newUrl } = await uploadToSupabase(f);
              publicUrl = newUrl;
              name = f.name;
              renderSourceFile();
              logMessage(`Source file selected for ${operationName}: ${name}`);
          } catch (err) {
              alert(err.message);
          }
      });
      
      supaRefreshBtn.addEventListener("click", () => {
          loadSupabaseList(supaListEl, ({ fileName, publicUrl: newUrl }) => {
              publicUrl = newUrl;
              name = fileName;
              renderSourceFile();
              logMessage(`Supabase file selected for ${operationName}: ${name}`);
              // Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªØ§Ø± ÙÙ‚Ø·
              supaListEl.textContent = currentLang === 'ar' ? 'ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­.' : 'File selected successfully.';
          });
      });
      
      // Ø¥Ø±Ø¬Ø§Ø¹ ÙˆØ¸ÙŠÙØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
      return {
          getPublicUrl: () => publicUrl,
          getFileName: () => name,
          reset: () => { publicUrl = null; name = null; renderSourceFile(); }
      };
  }
  
  // ===============================
  // âœ… Split Section
  // ===============================
  
  const splitSource = wireSourceSelection(
      document.getElementById("split-local-btn"),
      document.getElementById("split-input"),
      document.getElementById("split-supa-refresh"),
      document.getElementById("split-supa-list"),
      "Split"
  );
  const splitPagesInput = document.getElementById("split-pages-input");
  const splitExtractBtn = document.getElementById("split-extract-btn");

  splitExtractBtn.addEventListener("click", async () => {
    const publicUrl = splitSource.getPublicUrl();
    const splitName = splitSource.getFileName();
    
    if (!publicUrl) {
      alert(currentLang === "ar" ? "Ø§Ø®ØªØ± Ù…Ù„ÙÙ‹Ø§ Ø£ÙˆÙ„Ù‹Ø§" : "Select a file first");
      return;
    }
    const pages = splitPagesInput.value.trim();
    if (!pages) return;
    try {
      logMessage(`Extracting pages ${pages} from ${splitName}...`);
      await callBackendPdf("extract-pages", { publicUrl, pages }, "extracted-" + (splitName || "pages") + ".pdf");
      addHistoryEntry("Extract Pages", splitName || "file", true);
      logMessage("Page extraction successful.");
    } catch (e) {
      addHistoryEntry("Extract Pages", splitName || "file", false);
      logMessage("Extract pages failed: " + e.message, "error");
      alert(e.message);
    }
  });


  // ===============================
  // âœ… Text Section
  // ===============================

  const textSource = wireSourceSelection(
      document.getElementById("text-local-btn"),
      document.getElementById("text-input"),
      document.getElementById("text-supa-refresh"),
      document.getElementById("text-supa-list"),
      "Text Extract"
  );
  const textExtractBtn = document.getElementById("text-extract-btn");
  const textOutput = document.getElementById("text-output");
  const textCopyBtn = document.getElementById("text-copy-btn");
  const textDownloadBtn = document.getElementById("text-download-btn");

  let lastExtractedText = "";

  textExtractBtn.addEventListener("click", async () => {
    const publicUrl = textSource.getPublicUrl();
    const textName = textSource.getFileName();
    
    if (!publicUrl) {
      alert(currentLang === "ar" ? "Ø§Ø®ØªØ± Ù…Ù„ÙÙ‹Ø§ Ø£ÙˆÙ„Ù‹Ø§" : "Select a file first");
      return;
    }
    textOutput.textContent = currentLang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ...' : 'Extracting text...';
    try {
      logMessage(`Extracting text from ${textName}...`);
      const data = await callBackendJson("extract-text", { publicUrl });
      lastExtractedText = data.text || "";
      textOutput.textContent = lastExtractedText;
      addHistoryEntry("Extract Text", textName || "file", true);
      logMessage("Text extraction successful.");
    } catch (e) {
      textOutput.textContent = (currentLang === 'ar' ? 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬: ' : 'Extraction Error: ') + e.message;
      addHistoryEntry("Extract Text", textName || "file", false);
      logMessage("Extract text failed: " + e.message, "error");
      alert(e.message);
    }
  });

  textCopyBtn.addEventListener("click", async () => {
    if (!lastExtractedText) return;
    try {
      await navigator.clipboard.writeText(lastExtractedText);
      logMessage("Text copied");
    } catch (e) {
        logMessage(`Copy failed: ${e.message}`, "error");
    }
  });

  textDownloadBtn.addEventListener("click", () => {
    if (!lastExtractedText) return;
    const blob = new Blob([lastExtractedText], { type: "text/plain;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = (textSource.getFileName() || "extracted") + ".txt";
    a.click();
    URL.revokeObjectURL(url);
    logMessage("Text downloaded.");
  });
  
  
  // ===============================
  // âœ… Info Section (Modified)
  // ===============================

  const infoSource = wireSourceSelection(
      document.getElementById("info-local-btn"),
      document.getElementById("info-input"),
      document.getElementById("info-supa-refresh"),
      document.getElementById("info-supa-list"),
      "PDF Info"
  );
  const infoFetchBtn = document.getElementById("info-fetch-btn");
  const infoResultChips = document.getElementById("info-result-chips");

  infoFetchBtn.addEventListener("click", async () => {
    const publicUrl = infoSource.getPublicUrl();
    const infoName = infoSource.getFileName();
    
    if (!publicUrl) {
      alert(currentLang === "ar" ? "Ø§Ø®ØªØ± Ù…Ù„ÙÙ‹Ø§ Ø£ÙˆÙ„Ù‹Ø§" : "Select a file first");
      return;
    }
    
    infoResultChips.innerHTML = currentLang === "ar" ? "Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª..." : "Fetching info...";
    
    try {
      logMessage(`Fetching info for ${infoName}...`);
      const data = await callBackendJson("info", { publicUrl });
      
      infoResultChips.innerHTML = `
        <div class="chip" data-i18n="pagesCount">${currentLang === "ar" ? "Ø§Ù„ØµÙØ­Ø§Øª" : "Pages"}: ${data.pages}</div>
        <div class="chip" data-i18n="fileSize">${currentLang === "ar" ? "Ø§Ù„Ø­Ø¬Ù…" : "Size"}: ${data.sizeMB.toFixed(2)} MB</div>
        <div class="chip" data-i18n="sizeBytes">${currentLang === "ar" ? "Ø¨Ø§Ù„Ø¨Ø§ÙŠØª" : "Bytes"}: ${data.sizeBytes}</div>
      `;
      
      addHistoryEntry("Info", infoName || "file", true);
      logMessage("Info fetched successfully.");
    } catch (e) {
      infoResultChips.innerHTML = `<div class="chip" style="background: var(--danger); color: white;">${currentLang === "ar" ? "Ø®Ø·Ø£: " : "Error: "}${e.message}</div>`;
      addHistoryEntry("Info", infoName || "file", false);
      logMessage("Info fetching failed: " + e.message, "error");
      alert(e.message);
    }
  });
  
  
  // ===============================
  // âœ… Protect Section
  // ===============================
  
  const protectSource = wireSourceSelection(
      document.getElementById("protect-local-btn"),
      document.getElementById("protect-input"),
      document.getElementById("protect-supa-refresh"),
      document.getElementById("protect-supa-list"),
      "Protect"
  );
  const protectBtn = document.getElementById("protect-btn");
  const protectPasswordInput = document.getElementById("protect-password-input");

  protectBtn.addEventListener("click", async () => {
    const publicUrl = protectSource.getPublicUrl();
    const protectName = protectSource.getFileName();
    const password = protectPasswordInput.value.trim();
    
    if (!publicUrl) return alert(currentLang === "ar" ? "Ø§Ø®ØªØ± Ù…Ù„Ù" : "Select a file");
    if (!password) return alert(currentLang === "ar" ? "Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±" : "Enter a password");

    try {
        logMessage(`Protecting file ${protectName}...`);
        await callBackendPdf("protect", { publicUrl, password }, "protected-" + (protectName || "file") + ".pdf");
        addHistoryEntry("Protect", protectName || "file", true);
        logMessage("Protection successful.");
    } catch (e) {
        addHistoryEntry("Protect", protectName || "file", false);
        logMessage("Protection failed: " + e.message, "error");
        alert(e.message);
    }
  });
  
  // ===============================
  // âœ… Unlock Section
  // ===============================

  const unlockSource = wireSourceSelection(
      document.getElementById("unlock-local-btn"),
      document.getElementById("unlock-input"),
      document.getElementById("unlock-supa-refresh"),
      document.getElementById("unlock-supa-list"),
      "Unlock"
  );
  const unlockBtn = document.getElementById("unlock-btn");

  unlockBtn.addEventListener("click", async () => {
    const publicUrl = unlockSource.getPublicUrl();
    const unlockName = unlockSource.getFileName();
    
    if (!publicUrl) return alert(currentLang === "ar" ? "Ø§Ø®ØªØ± Ù…Ù„Ù" : "Select a file");

    try {
        logMessage(`Unlocking file ${unlockName}...`);
        await callBackendPdf("unlock", { publicUrl }, "unlocked-" + (unlockName || "file") + ".pdf");
        addHistoryEntry("Unlock", unlockName || "file", true);
        logMessage("Unlock successful.");
    } catch (e) {
        addHistoryEntry("Unlock", unlockName || "file", false);
        logMessage("Unlock failed: " + e.message, "error");
        alert(e.message);
    }
  });


  // ===============================
  // âœ… Watermark Section
  // ===============================

  const watermarkSource = wireSourceSelection(
      document.getElementById("wm-local-btn"),
      document.getElementById("wm-input"),
      document.getElementById("wm-supa-refresh"),
      document.getElementById("wm-supa-list"),
      "Watermark"
  );
  const wmApplyBtn = document.getElementById("wm-apply-btn");
  const wmTextInput = document.getElementById("wm-text-input");
  const wmColorSelect = document.getElementById("wm-color-select");
  const wmOpacityInput = document.getElementById("wm-opacity-input");

  wmApplyBtn.addEventListener("click", async () => {
    const publicUrl = watermarkSource.getPublicUrl();
    const watermarkName = watermarkSource.getFileName();
    const text = wmTextInput.value.trim();
    
    if (!publicUrl) return alert(currentLang === "ar" ? "Ø§Ø®ØªØ± Ù…Ù„Ù" : "Select a file");
    if (!text) return alert(currentLang === "ar" ? "Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©" : "Enter watermark text");
    
    const opacity = parseFloat(wmOpacityInput.value);

    const payload = {
        publicUrl,
        text,
        color: wmColorSelect.value,
        opacity: isNaN(opacity) ? 0.2 : opacity
    };

    try {
        logMessage(`Applying watermark to ${watermarkName}...`);
        await callBackendPdf("watermark-text", payload, "watermarked-" + (watermarkName || "file") + ".pdf");
        addHistoryEntry("Watermark", watermarkName || "file", true);
        logMessage("Watermark successful.");
    } catch (e) {
        addHistoryEntry("Watermark", watermarkName || "file", false);
        logMessage("Watermark failed: " + e.message, "error");
        alert(e.message);
    }
  });


  // ===============================
  // âœ… Rotate Pages Section
  // ===============================

  const rotateSource = wireSourceSelection(
      document.getElementById("rot-local-btn"),
      document.getElementById("rot-input"),
      document.getElementById("rot-supa-refresh"),
      document.getElementById("rot-supa-list"),
      "Rotate"
  );
  const rotApplyBtn = document.getElementById("rot-apply-btn");
  const rotAngleSelect = document.getElementById("rot-angle-select");
  const rotPagesInput = document.getElementById("rot-pages-input");

  rotApplyBtn.addEventListener("click", async () => {
    const publicUrl = rotateSource.getPublicUrl();
    const rotateName = rotateSource.getFileName();
    const angle = parseInt(rotAngleSelect.value);
    const pages = rotPagesInput.value.trim();
    
    if (!publicUrl) return alert(currentLang === "ar" ? "Ø§Ø®ØªØ± Ù…Ù„Ù" : "Select a file");
    
    const payload = { publicUrl, angle };
    if (pages) payload.pages = pages;

    try {
        logMessage(`Rotating file ${rotateName} by ${angle}Â°...`);
        await callBackendPdf("rotate-pages", payload, "rotated-" + (rotateName || "file") + ".pdf");
        addHistoryEntry("Rotate", rotateName || "file", true);
        logMessage("Rotation successful.");
    } catch (e) {
        addHistoryEntry("Rotate", rotateName || "file", false);
        logMessage("Rotation failed: " + e.message, "error");
        alert(e.message);
    }
  });
  
  // ===============================
  // âœ… Reorder Pages Subsection
  // ===============================

  // ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø¯Ø§Ù„Ø© rotateSource Ù„Ø£Ù†Ù‡Ø§ ØªØ®Øµ Ù†ÙØ³ Ù‚Ø³Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù
  const reorderApplyBtn = document.getElementById("reorder-apply-btn");
  const reorderInput = document.getElementById("reorder-input");

  reorderApplyBtn.addEventListener("click", async () => {
    const publicUrl = rotateSource.getPublicUrl(); // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø§Ù„Ù…ØµØ¯Ø±
    const rotateName = rotateSource.getFileName();
    const orderStr = reorderInput.value.trim();
    
    if (!publicUrl) return alert(currentLang === "ar" ? "Ø§Ø®ØªØ± Ù…Ù„Ù" : "Select a file");
    if (!orderStr) return alert(currentLang === "ar" ? "Ø£Ø¯Ø®Ù„ ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙØ­Ø§Øª" : "Enter pages order");

    const order = orderStr.split(",").map(n => parseInt(n.trim())).filter(n => !isNaN(n) && n > 0);

    if (order.length === 0) return alert(currentLang === "ar" ? "ØµÙŠØºØ© Ø§Ù„ØªØ±ØªÙŠØ¨ ØºÙŠØ± ØµØ­ÙŠØ­Ø©" : "Invalid order format");

    try {
        logMessage(`Reordering pages for ${rotateName}...`);
        await callBackendPdf("reorder-pages", { publicUrl, order }, "reordered-" + (rotateName || "file") + ".pdf");
        addHistoryEntry("Reorder", rotateName || "file", true);
        logMessage("Reorder successful.");
    } catch (e) {
        addHistoryEntry("Reorder", rotateName || "file", false);
        logMessage("Reorder failed: " + e.message, "error");
        alert(e.message);
    }
  });


  // ===============================
  // âœ… Supabase File Manager
  // ===============================

  const supaListContainer = document.getElementById("supa-list-container");
  const supaRefreshBtn = document.getElementById("supa-refresh-btn");
  const supaUploadDrop = document.getElementById("supa-upload-drop");
  const supaUploadInput = document.getElementById("supa-upload-input");

  // Ø¯Ø§Ù„Ø© Ø®Ø§ØµØ© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯ÙŠØ± (Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)
  async function loadSupabaseManager() {
    supaListContainer.innerHTML = currentLang === "ar" ? "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„..." : "Loading...";
    const { data, error } = await supabase.storage.from(BUCKET_NAME).list();
    
    supaListContainer.innerHTML = "";
    if (error) {
        supaListContainer.textContent = error.message;
        return;
    }
    
    const pdfFiles = data.filter(file => file.name !== ".emptyFolderPlaceholder");

    pdfFiles.forEach(file => {
      const { data: pub } = supabase.storage.from(BUCKET_NAME).getPublicUrl(file.name);
      const publicUrl = pub.publicUrl;

      const row = document.createElement("div");
      row.className = "file-item"; // Ø§Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ ØªØµÙ…ÙŠÙ… file-item Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„ØªÙ†Ø§Ø³Ù‚
      
      row.innerHTML = `
        <div class="file-item-header">
            <div class="file-name">${file.name}</div>
        </div>
        <div class="file-meta row">
            <button class="btn-secondary btn-sm" data-action="copy" data-name="${file.name}">
                <span data-i18n="btnCopy">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</span>
            </button>
            <button class="btn-secondary btn-sm" data-action="compress" data-name="${file.name}">
                <span data-i18n="navCompress">Ø¶ØºØ·</span>
            </button>
            <button class="btn-danger btn-sm" data-action="delete" data-name="${file.name}">
                <span data-i18n="btnDelete">Ø­Ø°Ù</span>
            </button>
        </div>
      `;

      supaListContainer.appendChild(row);
    });
    
    if (pdfFiles.length === 0) {
        supaListContainer.textContent = currentLang === "ar" ? "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª PDF ÙÙŠ Supabase" : "No PDF files found in Supabase";
    }
  }

  supaRefreshBtn.addEventListener("click", loadSupabaseManager);

  // Ø±Ø¨Ø· Ø§Ù„Ù€ Drop & Input
  wireFileDrop(supaUploadDrop, supaUploadInput, async (files) => {
    for (const file of files) {
        try {
            await uploadToSupabase(file);
            addHistoryEntry("Supa Upload", file.name, true);
        } catch (e) {
            addHistoryEntry("Supa Upload", file.name, false);
            alert((currentLang === 'ar' ? "ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹: " : "Upload Failed: ") + e.message);
        }
    }
    loadSupabaseManager(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø±ÙØ¹
  });

  supaListContainer.addEventListener("click", async (e) => {
    const btn = e.target.closest("button");
    if (!btn || !btn.dataset.action) return;

    const name = btn.dataset.name;
    const action = btn.dataset.action;

    try {
        const { data: pub } = supabase.storage.from(BUCKET_NAME).getPublicUrl(name);
        const publicUrl = pub.publicUrl;

        if (action === "copy") {
            await navigator.clipboard.writeText(publicUrl);
            logMessage(`Copied URL for: ${name}`);
        } else if (action === "compress") {
            logMessage(`Compressing from Supabase: ${name}`);
            await callBackendPdf("compress", { publicUrl }, "compressed-" + name);
            addHistoryEntry("Supa Compress", name, true);
        } else if (action === "delete") {
            if (!confirm(currentLang === 'ar' ? `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù: ${name}ØŸ` : `Are you sure you want to delete ${name}?`)) return;
            logMessage(`Deleting file: ${name}`);
            const { error } = await supabase.storage.from(BUCKET_NAME).remove([name]);
            if (error) throw error;
            addHistoryEntry("Supa Delete", name, true);
            loadSupabaseManager();
        }
    } catch (e) {
        logMessage(`${action} failed for ${name}: ${e.message}`, "error");
        alert(e.message);
    }
  });

</script>
</body>
</html>
